<!-- ========================================= -->
<!-- PARTE 1 DI 4 - VERSIONE FINALE CON TUTTE LE MODIFICHE -->
<!-- ========================================= -->

<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5, user-scalable=yes">
  <title>Nodo - Pokémon Collection</title>

  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <!-- Tesseract.js -->
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>

  <style>
    /* ========== RESET E BASE ========== */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, Arial, sans-serif;
      background: linear-gradient(135deg, #000000 0%, #1a1a1a 100%);
      min-height: 100vh;
      padding-bottom: 120px;
      color: #e5e7eb;
      overflow-x: hidden;
    }

    /* ========== PARTICELLE ANIMATE ========== */
    .particles {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 0;
    }

    .particle {
      position: absolute;
      width: 4px;
      height: 4px;
      background: #fbbf24;
      border-radius: 50%;
      opacity: 0;
      animation: float 15s infinite;
    }

    @keyframes float {
      0%, 100% {
        opacity: 0;
        transform: translateY(0) translateX(0) scale(0);
      }
      10% { opacity: 1; }
      90% { opacity: 1; }
      100% {
        opacity: 0;
        transform: translateY(-100vh) translateX(50px) scale(1);
      }
    }

    /* ========== HEADER ========== */
    .header {
      background: linear-gradient(135deg, #1a1a1a 0%, #0a0a0a 100%);
      backdrop-filter: blur(20px);
      padding: 20px;
      box-shadow: 0 8px 40px rgba(251, 191, 36, 0.3);
      position: sticky;
      top: 0;
      z-index: 1000;
      border-bottom: 3px solid #fbbf24;
      animation: headerGlow 3s ease-in-out infinite;
    }

    @keyframes headerGlow {
      0%, 100% { box-shadow: 0 8px 40px rgba(251, 191, 36, 0.3); }
      50% { box-shadow: 0 8px 60px rgba(251, 191, 36, 0.6); }
    }

    h1 {
      text-align: center;
      font-size: 38px;
      font-weight: 900;
      margin-bottom: 0;
      text-shadow: 0 0 40px rgba(251, 191, 36, 0.8);
    }

    .title-gradient {
      background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 25%, #fbbf24 50%, #f59e0b 75%, #fbbf24 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      background-size: 300% auto;
      animation: shimmer 4s linear infinite;
    }

    @keyframes shimmer {
      0% { background-position: 0% center; }
      100% { background-position: 300% center; }
    }

    /* ========== MENU NAVIGAZIONE BOTTOM ========== */
    .bottom-nav {
      position: fixed;
      bottom: 20px;
      left: 20px;
      z-index: 2000;
    }

    .menu-main-btn {
      width: 64px;
      height: 64px;
      border-radius: 50%;
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      border: none;
      color: #fff;
      font-size: 28px;
      cursor: pointer;
      box-shadow: 0 8px 30px rgba(16, 185, 129, 0.6);
      transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      position: relative;
      z-index: 2001;
    }

    .menu-main-btn:active {
      transform: scale(0.95);
    }

    .menu-main-btn.active {
      transform: rotate(45deg);
    }

    .menu-items {
      position: absolute;
      bottom: 0;
      left: 0;
      pointer-events: none;
    }

    .menu-item {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background: linear-gradient(135deg, #1f1f1f 0%, #0f0f0f 100%);
      border: 3px solid #10b981;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 22px;
      color: #10b981;
      cursor: pointer;
      opacity: 0;
      transform: scale(0);
      transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      pointer-events: none;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
    }

    .menu-item.active {
      opacity: 1;
      transform: scale(1);
      pointer-events: all;
    }

    .menu-item:active {
      transform: scale(0.9);
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      color: #fff;
    }

    .menu-label {
      position: absolute;
      left: 70px;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(0, 0, 0, 0.95);
      padding: 8px 16px;
      border-radius: 12px;
      border: 2px solid #10b981;
      color: #10b981;
      font-weight: 700;
      font-size: 14px;
      white-space: nowrap;
      opacity: 1;
      pointer-events: all;
      transition: all 0.3s;
      box-shadow: 0 4px 20px rgba(16, 185, 129, 0.4);
    }

    .menu-item:hover .menu-label {
      opacity: 1;
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      color: #fff;
      transform: translateY(-50%) scale(1.05);
    }

    /* ========== DASHBOARD CRUSCOTTI ========== */
    .dashboard {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
      margin: 20px;
      position: relative;
      z-index: 1;
    }

    .stat-card {
      background: linear-gradient(135deg, #1f1f1f 0%, #0f0f0f 100%);
      padding: 28px;
      border-radius: 24px;
      box-shadow: 0 12px 50px rgba(0, 0, 0, 0.7);
      position: relative;
      overflow: hidden;
      transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
      cursor: pointer;
      border: 2px solid #2a2a2a;
    }

    .stat-card::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      transform: scale(0);
      transition: transform 0.6s;
    }

    .stat-card:active::before {
      transform: scale(1);
    }

    .stat-card:active {
      transform: translateY(-8px) scale(1.02);
    }

    .stat-card::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 6px;
    }

    /* Colori specifici per ogni card */
    .stat-card.yellow::before { background: radial-gradient(circle, rgba(251, 191, 36, 0.15) 0%, transparent 70%); }
    .stat-card.yellow::after { background: linear-gradient(90deg, #fbbf24 0%, #f59e0b 100%); }
    .stat-card.yellow .stat-icon { background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%); box-shadow: 0 10px 30px rgba(251, 191, 36, 0.5); }
    .stat-card.yellow .stat-value { background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }

    .stat-card.green::before { background: radial-gradient(circle, rgba(16, 185, 129, 0.15) 0%, transparent 70%); }
    .stat-card.green::after { background: linear-gradient(90deg, #10b981 0%, #059669 100%); }
    .stat-card.green .stat-icon { background: linear-gradient(135deg, #10b981 0%, #059669 100%); box-shadow: 0 10px 30px rgba(16, 185, 129, 0.5); }
    .stat-card.green .stat-value { background: linear-gradient(135deg, #10b981 0%, #059669 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }

    .stat-card.orange::before { background: radial-gradient(circle, rgba(249, 115, 22, 0.15) 0%, transparent 70%); }
    .stat-card.orange::after { background: linear-gradient(90deg, #f97316 0%, #ea580c 100%); }
    .stat-card.orange .stat-icon { background: linear-gradient(135deg, #f97316 0%, #ea580c 100%); box-shadow: 0 10px 30px rgba(249, 115, 22, 0.5); }
    .stat-card.orange .stat-value { background: linear-gradient(135deg, #f97316 0%, #ea580c 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }

    .stat-card.blue::before { background: radial-gradient(circle, rgba(59, 130, 246, 0.15) 0%, transparent 70%); }
    .stat-card.blue::after { background: linear-gradient(90deg, #3b82f6 0%, #2563eb 100%); }
    .stat-card.blue .stat-icon { background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); box-shadow: 0 10px 30px rgba(59, 130, 246, 0.5); }
    .stat-card.blue .stat-value { background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }

    .stat-icon {
      width: 70px;
      height: 70px;
      border-radius: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 32px;
      margin-bottom: 20px;
      color: #000;
      animation: iconPulse 2s ease-in-out infinite;
    }

    @keyframes iconPulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.08); }
    }

    .stat-label {
      font-size: 13px;
      font-weight: 700;
      color: #9ca3af;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 12px;
    }

    .stat-value {
      font-size: 38px;
      font-weight: 900;
      line-height: 1;
      margin-bottom: 10px;
    }

    .stat-subtext {
      font-size: 13px;
      color: #6b7280;
      font-weight: 600;
    }

    /* ========== CONTENITORE PRINCIPALE ========== */
    .main-content {
      padding: 0 20px 40px 20px;
      max-width: 1400px;
      margin: 0 auto;
      position: relative;
      z-index: 1;
    }

    /* ========== BOX FILTRI ========== */
    .filter-box {
      background: linear-gradient(135deg, #1f1f1f 0%, #1a1a1a 100%);
      border-radius: 24px;
      padding: 0;
      border: 2px solid #2a2a2a;
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.5);
      margin-bottom: 20px;
      position: relative;
      overflow: hidden;
    }

    .filter-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px;
      background: linear-gradient(135deg, #1f1f1f 0%, #1a1a1a 100%);
      border-radius: 24px 24px 0 0;
      border-bottom: 2px solid transparent;
      transition: border-bottom-color 0.3s ease;
      position: relative;
      z-index: 10;
    }

    .filter-title {
      font-size: 20px;
      font-weight: 800;
      background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .filter-toggle {
      padding: 12px 20px;
      border-radius: 16px;
      border: 2px solid #fbbf24;
      background: transparent;
      color: #fbbf24;
      font-size: 14px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .filter-toggle:active {
      transform: scale(0.95) rotate(180deg);
    }

    .filter-toggle.expanded {
      background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
      color: #000;
      transform: rotate(180deg);
    }

    .filter-content {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.5s cubic-bezier(0.4, 0, 0.2, 1);
      padding: 0 20px;
      background: transparent;
    }

    .filter-content.active {
      max-height: 2000px;
      padding: 20px;
      padding-bottom: 30px;
    }

    .filter-grid {
      display: grid;
      gap: 20px;
      margin-bottom: 20px;
    }

    .filter-group label {
      display: block;
      margin-bottom: 10px;
      font-weight: 700;
      color: #fbbf24;
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .filter-group input[type="text"],
    .filter-group select {
      width: 100%;
      padding: 16px;
      border-radius: 16px;
      border: 2px solid #2a2a2a;
      font-size: 16px;
      transition: all 0.3s ease;
      background: #0a0a0a;
      color: #e5e7eb;
      font-weight: 500;
    }

    .filter-group input::placeholder {
      color: #6b7280;
    }

    .filter-group input:focus,
    .filter-group select:focus {
      outline: none;
      border-color: #fbbf24;
      background: #1a1a1a;
      box-shadow: 0 0 0 4px rgba(251, 191, 36, 0.2);
    }

    .filter-group select {
      cursor: pointer;
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23fbbf24' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 12px center;
      padding-right: 36px;
    }

    /* ========== RANGE SLIDER ========== */
    .range-group {
      margin-bottom: 24px;
    }

    .range-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    .range-label {
      font-weight: 700;
      color: #fbbf24;
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .range-value {
      font-weight: 800;
      color: #10b981;
      font-size: 18px;
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .range-slider-container {
      position: relative;
      height: 60px;
      padding: 0 10px;
    }

    .range-track {
      position: absolute;
      top: 50%;
      left: 10px;
      right: 10px;
      height: 8px;
      background: linear-gradient(90deg, #2a2a2a 0%, #3a3a3a 100%);
      border-radius: 10px;
      transform: translateY(-50%);
    }

    .range-progress {
      position: absolute;
      height: 100%;
      background: linear-gradient(90deg, #10b981 0%, #059669 100%);
      border-radius: 10px;
      transition: all 0.1s ease;
    }

    .range-input {
      position: absolute;
      top: 50%;
      width: calc(100% - 20px);
      left: 10px;
      transform: translateY(-50%);
      height: 8px;
      -webkit-appearance: none;
      appearance: none;
      background: transparent;
      pointer-events: none;
      outline: none;
    }

    .range-input::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 28px;
      height: 28px;
      border-radius: 50%;
      background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
      border: 4px solid #000;
      cursor: pointer;
      pointer-events: all;
      box-shadow: 0 4px 15px rgba(251, 191, 36, 0.5);
      transition: all 0.2s ease;
    }

    .range-input::-webkit-slider-thumb:active {
      transform: scale(1.3);
      box-shadow: 0 6px 25px rgba(251, 191, 36, 0.8);
    }

    .range-input::-moz-range-thumb {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
      border: 4px solid #000;
      cursor: pointer;
      pointer-events: all;
      box-shadow: 0 4px 15px rgba(251, 191, 36, 0.5);
      transition: all 0.2s ease;
    }

    .range-input::-moz-range-thumb:active {
      transform: scale(1.3);
      box-shadow: 0 6px 25px rgba(251, 191, 36, 0.8);
    }

    /* ========== TOGGLE BUTTONS ========== */
    .toggle-group {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin-bottom: 20px;
    }

    .toggle-option input[type="checkbox"] {
      display: none;
    }

    .toggle-label {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 16px;
      border-radius: 16px;
      border: 2px solid #2a2a2a;
      background: #0a0a0a;
      color: #9ca3af;
      font-size: 14px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .toggle-option input:checked + .toggle-label {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      border-color: #10b981;
      color: #fff;
      transform: scale(1.05);
      box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
    }

    .toggle-label:active {
      transform: scale(0.95);
    }

    /* ========== PULSANTI FILTRO ========== */
    .filter-actions {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-top: 24px;
    }

    .btn-filter {
      padding: 18px;
      border-radius: 16px;
      border: none;
      font-size: 15px;
      font-weight: 800;
      cursor: pointer;
      transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      text-transform: uppercase;
      letter-spacing: 1px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .btn-apply {
      background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
      color: #000;
      box-shadow: 0 6px 20px rgba(251, 191, 36, 0.4);
    }

    .btn-apply:active {
      transform: scale(0.95);
      box-shadow: 0 10px 30px rgba(251, 191, 36, 0.6);
    }

    .btn-reset {
      background: #2a2a2a;
      color: #e5e7eb;
    }

    .btn-reset:active {
      background: #3a3a3a;
      transform: scale(0.95);
    }
  </style>

<!-- FINE PARTE 1 - Continua con PARTE 2 -->
<!-- ========================================= -->







  
<!-- ========================================= -->
<!-- PARTE 1 DI 4 - VERSIONE FINALE CON TUTTE LE MODIFICHE -->
<!-- ========================================= -->

<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5, user-scalable=yes">
  <title>Nodo - Pokémon Collection</title>

  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <!-- Tesseract.js -->
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>

  <style>
    /* ========== RESET E BASE ========== */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, Arial, sans-serif;
      background: linear-gradient(135deg, #000000 0%, #1a1a1a 100%);
      min-height: 100vh;
      padding-bottom: 120px;
      color: #e5e7eb;
      overflow-x: hidden;
    }

    /* ========== PARTICELLE ANIMATE ========== */
    .particles {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 0;
    }

    .particle {
      position: absolute;
      width: 4px;
      height: 4px;
      background: #fbbf24;
      border-radius: 50%;
      opacity: 0;
      animation: float 15s infinite;
    }

    @keyframes float {
      0%, 100% {
        opacity: 0;
        transform: translateY(0) translateX(0) scale(0);
      }
      10% { opacity: 1; }
      90% { opacity: 1; }
      100% {
        opacity: 0;
        transform: translateY(-100vh) translateX(50px) scale(1);
      }
    }

    /* ========== HEADER ========== */
    .header {
      background: linear-gradient(135deg, #1a1a1a 0%, #0a0a0a 100%);
      backdrop-filter: blur(20px);
      padding: 20px;
      box-shadow: 0 8px 40px rgba(251, 191, 36, 0.3);
      position: sticky;
      top: 0;
      z-index: 1000;
      border-bottom: 3px solid #fbbf24;
      animation: headerGlow 3s ease-in-out infinite;
    }

    @keyframes headerGlow {
      0%, 100% { box-shadow: 0 8px 40px rgba(251, 191, 36, 0.3); }
      50% { box-shadow: 0 8px 60px rgba(251, 191, 36, 0.6); }
    }

    h1 {
      text-align: center;
      font-size: 38px;
      font-weight: 900;
      margin-bottom: 0;
      text-shadow: 0 0 40px rgba(251, 191, 36, 0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 16px;
    }

    .title-gradient {
      background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 25%, #fbbf24 50%, #f59e0b 75%, #fbbf24 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      background-size: 300% auto;
      animation: shimmer 4s linear infinite;
    }
    
    .header-logo {
      width: 50px;
      height: 50px;
      position: relative;
      flex-shrink: 0;
    }
    
    .header-logo-ring {
      position: absolute;
      border: 3px solid #fbbf24;
      border-radius: 50%;
      box-shadow: 0 0 20px rgba(251, 191, 36, 0.6);
    }
    
    .header-logo-ring-1 {
      width: 42px;
      height: 28px;
      top: 11px;
      left: -2px;
      transform: rotate(-20deg);
      animation: headerRing1 3s ease-in-out infinite;
    }
    
    .header-logo-ring-2 {
      width: 42px;
      height: 28px;
      top: 11px;
      right: -2px;
      transform: rotate(20deg);
      animation: headerRing2 3s ease-in-out infinite;
    }
    
    @keyframes headerRing1 {
      0%, 100% { transform: rotate(-20deg) scale(1); }
      50% { transform: rotate(-20deg) scale(1.05); }
    }
    
    @keyframes headerRing2 {
      0%, 100% { transform: rotate(20deg) scale(1); }
      50% { transform: rotate(20deg) scale(1.05); }
    }

    @keyframes shimmer {
      0% { background-position: 0% center; }
      100% { background-position: 300% center; }
    }

    /* ========== MENU NAVIGAZIONE BOTTOM ========== */
    .bottom-nav {
      position: fixed;
      bottom: 20px;
      left: 20px;
      z-index: 2000;
    }

    .menu-main-btn {
      width: 64px;
      height: 64px;
      border-radius: 50%;
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      border: none;
      color: #fff;
      font-size: 28px;
      cursor: pointer;
      box-shadow: 0 8px 30px rgba(16, 185, 129, 0.6);
      transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      position: relative;
      z-index: 2001;
    }

    .menu-main-btn:active {
      transform: scale(0.95);
    }

    .menu-main-btn.active {
      transform: rotate(45deg);
    }

    .menu-items {
      position: absolute;
      bottom: 0;
      left: 0;
      pointer-events: none;
    }

    .menu-item {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background: linear-gradient(135deg, #1f1f1f 0%, #0f0f0f 100%);
      border: 3px solid #10b981;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 22px;
      color: #10b981;
      cursor: pointer;
      opacity: 0;
      transform: scale(0);
      transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      pointer-events: none;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
    }

    .menu-item.active {
      opacity: 1;
      transform: scale(1);
      pointer-events: all;
    }

    .menu-item:active {
      transform: scale(0.9);
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      color: #fff;
    }

    .menu-label {
      position: absolute;
      left: 70px;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(0, 0, 0, 0.95);
      padding: 8px 16px;
      border-radius: 12px;
      border: 2px solid #10b981;
      color: #10b981;
      font-weight: 700;
      font-size: 14px;
      white-space: nowrap;
      opacity: 1;
      pointer-events: all;
      transition: all 0.3s;
      box-shadow: 0 4px 20px rgba(16, 185, 129, 0.4);
    }

    .menu-item:hover .menu-label {
      opacity: 1;
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      color: #fff;
      transform: translateY(-50%) scale(1.05);
    }

    /* ========== DASHBOARD CRUSCOTTI ========== */
    .dashboard {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
      margin: 20px;
      position: relative;
      z-index: 1;
    }

    .stat-card {
      background: linear-gradient(135deg, #1f1f1f 0%, #0f0f0f 100%);
      padding: 28px;
      border-radius: 24px;
      box-shadow: 0 12px 50px rgba(0, 0, 0, 0.7);
      position: relative;
      overflow: hidden;
      transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
      cursor: pointer;
      border: 2px solid #2a2a2a;
    }

    .stat-card::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      transform: scale(0);
      transition: transform 0.6s;
    }

    .stat-card:active::before {
      transform: scale(1);
    }

    .stat-card:active {
      transform: translateY(-8px) scale(1.02);
    }

    .stat-card::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 6px;
    }

    /* Colori specifici per ogni card */
    .stat-card.yellow::before { background: radial-gradient(circle, rgba(251, 191, 36, 0.15) 0%, transparent 70%); }
    .stat-card.yellow::after { background: linear-gradient(90deg, #fbbf24 0%, #f59e0b 100%); }
    .stat-card.yellow .stat-icon { background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%); box-shadow: 0 10px 30px rgba(251, 191, 36, 0.5); }
    .stat-card.yellow .stat-value { background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }

    .stat-card.green::before { background: radial-gradient(circle, rgba(16, 185, 129, 0.15) 0%, transparent 70%); }
    .stat-card.green::after { background: linear-gradient(90deg, #10b981 0%, #059669 100%); }
    .stat-card.green .stat-icon { background: linear-gradient(135deg, #10b981 0%, #059669 100%); box-shadow: 0 10px 30px rgba(16, 185, 129, 0.5); }
    .stat-card.green .stat-value { background: linear-gradient(135deg, #10b981 0%, #059669 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }

    .stat-card.orange::before { background: radial-gradient(circle, rgba(249, 115, 22, 0.15) 0%, transparent 70%); }
    .stat-card.orange::after { background: linear-gradient(90deg, #f97316 0%, #ea580c 100%); }
    .stat-card.orange .stat-icon { background: linear-gradient(135deg, #f97316 0%, #ea580c 100%); box-shadow: 0 10px 30px rgba(249, 115, 22, 0.5); }
    .stat-card.orange .stat-value { background: linear-gradient(135deg, #f97316 0%, #ea580c 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }

    .stat-card.blue::before { background: radial-gradient(circle, rgba(59, 130, 246, 0.15) 0%, transparent 70%); }
    .stat-card.blue::after { background: linear-gradient(90deg, #3b82f6 0%, #2563eb 100%); }
    .stat-card.blue .stat-icon { background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); box-shadow: 0 10px 30px rgba(59, 130, 246, 0.5); }
    .stat-card.blue .stat-value { background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }

    .stat-icon {
      width: 70px;
      height: 70px;
      border-radius: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 32px;
      margin-bottom: 20px;
      color: #000;
      animation: iconPulse 2s ease-in-out infinite;
    }

    @keyframes iconPulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.08); }
    }

    .stat-label {
      font-size: 13px;
      font-weight: 700;
      color: #9ca3af;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 12px;
    }

    .stat-value {
      font-size: 38px;
      font-weight: 900;
      line-height: 1;
      margin-bottom: 10px;
    }

    .stat-subtext {
      font-size: 13px;
      color: #6b7280;
      font-weight: 600;
    }

    /* ========== CONTENITORE PRINCIPALE ========== */
    .main-content {
      padding: 0 20px 40px 20px;
      max-width: 1400px;
      margin: 0 auto;
      position: relative;
      z-index: 1;
    }

    /* ========== BOX FILTRI ========== */
    .filter-box {
      background: linear-gradient(135deg, #1f1f1f 0%, #1a1a1a 100%);
      border-radius: 24px;
      padding: 0;
      border: 2px solid #2a2a2a;
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.5);
      margin-bottom: 20px;
      position: relative;
      overflow: hidden;
    }

    .filter-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px;
      background: linear-gradient(135deg, #1f1f1f 0%, #1a1a1a 100%);
      border-radius: 24px 24px 0 0;
      border-bottom: 2px solid transparent;
      transition: border-bottom-color 0.3s ease;
      position: relative;
      z-index: 10;
    }

    .filter-title {
      font-size: 20px;
      font-weight: 800;
      background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .filter-toggle {
      padding: 12px 20px;
      border-radius: 16px;
      border: 2px solid #fbbf24;
      background: transparent;
      color: #fbbf24;
      font-size: 14px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .filter-toggle:active {
      transform: scale(0.95) rotate(180deg);
    }

    .filter-toggle.expanded {
      background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
      color: #000;
      transform: rotate(180deg);
    }

    .filter-content {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.5s cubic-bezier(0.4, 0, 0.2, 1);
      padding: 0 20px;
      background: transparent;
    }

    .filter-content.active {
      max-height: 2000px;
      padding: 20px;
      padding-bottom: 30px;
    }

    .filter-grid {
      display: grid;
      gap: 20px;
      margin-bottom: 20px;
    }

    .filter-group label {
      display: block;
      margin-bottom: 10px;
      font-weight: 700;
      color: #fbbf24;
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .filter-group input[type="text"],
    .filter-group select {
      width: 100%;
      padding: 16px;
      border-radius: 16px;
      border: 2px solid #2a2a2a;
      font-size: 16px;
      transition: all 0.3s ease;
      background: #0a0a0a;
      color: #e5e7eb;
      font-weight: 500;
    }

    .filter-group input::placeholder {
      color: #6b7280;
    }

    .filter-group input:focus,
    .filter-group select:focus {
      outline: none;
      border-color: #fbbf24;
      background: #1a1a1a;
      box-shadow: 0 0 0 4px rgba(251, 191, 36, 0.2);
    }

    .filter-group select {
      cursor: pointer;
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23fbbf24' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 12px center;
      padding-right: 36px;
    }

    /* ========== RANGE SLIDER ========== */
    .range-group {
      margin-bottom: 24px;
    }

    .range-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    .range-label {
      font-weight: 700;
      color: #fbbf24;
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .range-value {
      font-weight: 800;
      color: #10b981;
      font-size: 18px;
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .range-slider-container {
      position: relative;
      height: 60px;
      padding: 0 10px;
    }

    .range-track {
      position: absolute;
      top: 50%;
      left: 10px;
      right: 10px;
      height: 8px;
      background: linear-gradient(90deg, #2a2a2a 0%, #3a3a3a 100%);
      border-radius: 10px;
      transform: translateY(-50%);
    }

    .range-progress {
      position: absolute;
      height: 100%;
      background: linear-gradient(90deg, #10b981 0%, #059669 100%);
      border-radius: 10px;
      transition: all 0.1s ease;
    }

    .range-input {
      position: absolute;
      top: 50%;
      width: calc(100% - 20px);
      left: 10px;
      transform: translateY(-50%);
      height: 8px;
      -webkit-appearance: none;
      appearance: none;
      background: transparent;
      pointer-events: none;
      outline: none;
    }

    .range-input::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 28px;
      height: 28px;
      border-radius: 50%;
      background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
      border: 4px solid #000;
      cursor: pointer;
      pointer-events: all;
      box-shadow: 0 4px 15px rgba(251, 191, 36, 0.5);
      transition: all 0.2s ease;
    }

    .range-input::-webkit-slider-thumb:active {
      transform: scale(1.3);
      box-shadow: 0 6px 25px rgba(251, 191, 36, 0.8);
    }

    .range-input::-moz-range-thumb {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
      border: 4px solid #000;
      cursor: pointer;
      pointer-events: all;
      box-shadow: 0 4px 15px rgba(251, 191, 36, 0.5);
      transition: all 0.2s ease;
    }

    .range-input::-moz-range-thumb:active {
      transform: scale(1.3);
      box-shadow: 0 6px 25px rgba(251, 191, 36, 0.8);
    }

    /* ========== TOGGLE BUTTONS ========== */
    .toggle-group {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin-bottom: 20px;
    }

    .toggle-option input[type="checkbox"] {
      display: none;
    }

    .toggle-label {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 16px;
      border-radius: 16px;
      border: 2px solid #2a2a2a;
      background: #0a0a0a;
      color: #9ca3af;
      font-size: 14px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .toggle-option input:checked + .toggle-label {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      border-color: #10b981;
      color: #fff;
      transform: scale(1.05);
      box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
    }

    .toggle-label:active {
      transform: scale(0.95);
    }

    /* ========== PULSANTI FILTRO ========== */
    .filter-actions {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-top: 24px;
    }

    .btn-filter {
      padding: 18px;
      border-radius: 16px;
      border: none;
      font-size: 15px;
      font-weight: 800;
      cursor: pointer;
      transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      text-transform: uppercase;
      letter-spacing: 1px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .btn-apply {
      background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
      color: #000;
      box-shadow: 0 6px 20px rgba(251, 191, 36, 0.4);
    }

    .btn-apply:active {
      transform: scale(0.95);
      box-shadow: 0 10px 30px rgba(251, 191, 36, 0.6);
    }

    .btn-reset {
      background: #2a2a2a;
      color: #e5e7eb;
    }

    .btn-reset:active {
      background: #3a3a3a;
      transform: scale(0.95);
    }
  </style>

<!-- FINE PARTE 1 - Continua con PARTE 2 -->






<!-- ========================================= -->
<!-- PARTE 2 DI 4 - VERSIONE FINALE CON TUTTE LE MODIFICHE -->
<!-- ========================================= -->

  <style>
    /* ========== PAGINAZIONE ========== */
    .pagination-container {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px;
      background: linear-gradient(135deg, #1f1f1f 0%, #1a1a1a 100%);
      border-radius: 20px;
      margin-bottom: 20px;
      border: 2px solid #2a2a2a;
    }

    .pagination-info {
      font-weight: 700;
      color: #fbbf24;
      font-size: 15px;
    }

    .pagination-info span {
      font-size: 24px;
      font-weight: 900;
      margin: 0 6px;
    }

    .pagination-controls {
      display: flex;
      gap: 12px;
    }

    .pagination-btn {
      width: 48px;
      height: 48px;
      border-radius: 14px;
      border: 2px solid #fbbf24;
      background: #0a0a0a;
      color: #fbbf24;
      font-size: 18px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .pagination-btn:disabled {
      opacity: 0.3;
      cursor: not-allowed;
      border-color: #2a2a2a;
      color: #6b7280;
    }

    .pagination-btn:not(:disabled):active {
      transform: scale(0.9);
      background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
      color: #000;
    }

    /* ========== CARDS ARTICOLI ========== */
    .articles-grid {
      display: grid;
      gap: 20px;
    }

    .article-card {
      background: linear-gradient(135deg, #1a1a1a 0%, #0f0f0f 100%);
      border-radius: 24px;
      overflow: hidden;
      border: 2px solid #2a2a2a;
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.7);
      transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    }

    .article-card:active {
      transform: translateY(-6px);
      box-shadow: 0 12px 50px rgba(251, 191, 36, 0.4);
      border-color: #fbbf24;
    }

    .article-header {
      padding: 20px;
      background: linear-gradient(135deg, #1f1f1f 0%, #1a1a1a 100%);
      border-bottom: 3px solid #fbbf24;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .article-image-placeholder {
      width: 70px;
      height: 70px;
      border-radius: 50%;
      background: linear-gradient(135deg, #2a2a2a 0%, #1a1a1a 100%);
      border: 3px solid #fbbf24;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      font-size: 11px;
      color: #fbbf24;
      font-weight: 700;
      text-align: center;
      padding: 8px;
    }

    .article-header-info {
      flex: 1;
      min-width: 0;
    }

    .article-title {
      font-weight: 800;
      font-size: 18px;
      color: #fbbf24;
      margin-bottom: 6px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
    }

    .article-title-text {
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .expand-icon {
      transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      font-size: 16px;
      flex-shrink: 0;
    }

    .article-card.expanded .expand-icon {
      transform: rotate(180deg);
    }

    .article-subtitle {
      font-size: 14px;
      color: #9ca3af;
      font-weight: 600;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .article-body {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.5s cubic-bezier(0.4, 0, 0.2, 1);
      background: #0f0f0f;
    }

    .article-card.expanded .article-body {
      max-height: 1000px;
    }

    .article-body-content {
      padding: 20px;
    }

    .article-row {
      display: flex;
      justify-content: space-between;
      padding: 14px 0;
      border-bottom: 1px solid #2a2a2a;
      gap: 16px;
    }

    .article-row:last-child {
      border-bottom: none;
    }

    .article-label {
      font-weight: 700;
      color: #9ca3af;
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .article-value {
      text-align: right;
      color: #e5e7eb;
      font-weight: 600;
      flex-shrink: 0;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      border-radius: 10px;
      font-size: 12px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .badge.presente {
      background: rgba(16, 185, 129, 0.2);
      color: #10b981;
      border: 2px solid #10b981;
      box-shadow: 0 0 15px rgba(16, 185, 129, 0.3);
    }

    .badge.assente {
      background: rgba(239, 68, 68, 0.2);
      color: #ef4444;
      border: 2px solid #ef4444;
      box-shadow: 0 0 15px rgba(239, 68, 68, 0.3);
    }

    .article-actions {
      margin-top: 20px;
      padding-top: 20px;
      border-top: 2px solid #2a2a2a;
    }

    .btn-edit {
      width: 100%;
      padding: 16px;
      border-radius: 16px;
      border: none;
      background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
      color: #000;
      font-size: 15px;
      font-weight: 800;
      cursor: pointer;
      transition: all 0.3s ease;
      text-transform: uppercase;
      letter-spacing: 1px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      box-shadow: 0 6px 20px rgba(251, 191, 36, 0.4);
    }

    .btn-edit:active {
      transform: scale(0.95);
      box-shadow: 0 10px 30px rgba(251, 191, 36, 0.6);
    }

    /* ========== BUTTON AGGIUNGI ========== */
    .add-btn-container {
      position: fixed;
      bottom: 100px;
      right: 20px;
      z-index: 1500;
      display: none;
    }

    .add-btn-container.visible {
      display: block;
    }

    .btn-add-main {
      width: 64px;
      height: 64px;
      border-radius: 50%;
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      border: none;
      color: #fff;
      font-size: 28px;
      cursor: pointer;
      box-shadow: 0 8px 30px rgba(16, 185, 129, 0.6);
      transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    }

    .btn-add-main:active {
      transform: scale(0.95) rotate(90deg);
    }

    /* ========== MODALS ========== */
    .modal-add, .modal-edit, .modal-graph {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.95);
      backdrop-filter: blur(8px);
      z-index: 2500;
      align-items: center;
      justify-content: center;
      padding: 20px;
      animation: fadeIn 0.4s ease;
    }

    .modal-add.active, .modal-edit.active, .modal-graph.active {
      display: flex;
    }

    .modal-add.closing, .modal-edit.closing, .modal-graph.closing {
      animation: fadeOut 0.4s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes fadeOut {
      from { opacity: 1; }
      to { opacity: 0; }
    }

    .modal-add-content, .modal-edit-content {
      background: linear-gradient(135deg, #1a1a1a 0%, #0f0f0f 100%);
      border-radius: 28px;
      padding: 28px;
      max-width: 95vw;
      width: 100%;
      max-height: 95vh;
      overflow-y: auto;
      box-shadow: 0 20px 80px rgba(16, 185, 129, 0.4);
      animation: scaleIn 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      border: 3px solid #10b981;
      position: relative;
      margin: auto;
    }

    .modal-add.closing .modal-add-content,
    .modal-edit.closing .modal-edit-content,
    .modal-graph.closing .modal-graph-content {
      animation: scaleOut 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    }

    .modal-edit-content {
      box-shadow: 0 20px 80px rgba(251, 191, 36, 0.4);
      border-color: #fbbf24;
    }

    @keyframes scaleIn {
      from { transform: scale(0.8) rotate(-5deg); opacity: 0; }
      to { transform: scale(1) rotate(0); opacity: 1; }
    }

    @keyframes scaleOut {
      from { transform: scale(1) rotate(0); opacity: 1; }
      to { transform: scale(0.8) rotate(5deg); opacity: 0; }
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
    }

    .modal-title {
      font-size: 24px;
      font-weight: 900;
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .modal-edit-content .modal-title {
      background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .modal-close {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      border: none;
      background: #2a2a2a;
      cursor: pointer;
      font-size: 24px;
      color: #e5e7eb;
      transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .modal-close:hover {
      background: #ef4444;
      color: #fff;
      transform: rotate(90deg);
    }

    .modal-close:active {
      background: #dc2626;
      transform: rotate(180deg) scale(0.9);
    }

    /* ========== FORM ========== */
    .form-grid {
      display: grid;
      gap: 20px;
    }

    .form-group label {
      display: block;
      margin-bottom: 10px;
      font-weight: 700;
      color: #fbbf24;
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .form-group input,
    .form-group textarea {
      width: 100%;
      padding: 16px;
      border-radius: 16px;
      border: 2px solid #2a2a2a;
      font-size: 16px;
      transition: all 0.3s ease;
      background: #0a0a0a;
      color: #e5e7eb;
      font-weight: 500;
    }

    .form-group input::placeholder,
    .form-group textarea::placeholder {
      color: #6b7280;
    }

    .form-group input:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: #10b981;
      background: #1a1a1a;
      box-shadow: 0 0 0 4px rgba(16, 185, 129, 0.2);
    }

    .form-group textarea {
      min-height: 100px;
      resize: vertical;
      font-family: inherit;
    }

    .checkbox-wrapper {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 18px;
      background: #0a0a0a;
      border-radius: 16px;
      cursor: pointer;
      transition: all 0.3s ease;
      border: 2px solid #2a2a2a;
    }

    .checkbox-wrapper:active {
      background: #1a1a1a;
      border-color: #3a3a3a;
    }

    .checkbox-wrapper input[type="checkbox"] {
      width: 24px;
      height: 24px;
      margin-right: 14px;
      cursor: pointer;
      accent-color: #10b981;
    }

    .checkbox-wrapper span {
      display: flex;
      align-items: center;
      gap: 8px;
      color: #e5e7eb;
      font-weight: 600;
    }

    .btn-submit {
      width: 100%;
      padding: 20px;
      border-radius: 16px;
      border: none;
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      color: white;
      font-size: 18px;
      font-weight: 800;
      cursor: pointer;
      transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
      margin-top: 24px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .btn-submit:active {
      transform: scale(0.95);
      box-shadow: 0 12px 35px rgba(16, 185, 129, 0.6);
    }

    .btn-scan {
      width: 100%;
      padding: 20px;
      border-radius: 20px;
      border: 3px solid #fbbf24;
      background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
      color: #000;
      font-size: 18px;
      font-weight: 900;
      cursor: pointer;
      transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      box-shadow: 0 8px 30px rgba(251, 191, 36, 0.5);
      margin-bottom: 24px;
      text-transform: uppercase;
      letter-spacing: 1.5px;
      position: relative;
      overflow: hidden;
    }

    .btn-scan::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.3);
      transform: translate(-50%, -50%);
      transition: width 0.6s, height 0.6s;
    }

    .btn-scan:active::before {
      width: 500px;
      height: 500px;
    }

    .btn-scan:active {
      transform: scale(0.95);
      box-shadow: 0 15px 50px rgba(251, 191, 36, 0.8);
    }

    .btn-delete {
      width: 100%;
      padding: 16px;
      border-radius: 16px;
      border: none;
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
      color: white;
      font-size: 15px;
      font-weight: 800;
      cursor: pointer;
      transition: all 0.3s ease;
      text-transform: uppercase;
      letter-spacing: 1px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      box-shadow: 0 6px 20px rgba(239, 68, 68, 0.4);
      margin-top: 24px;
    }

    .btn-delete:active {
      transform: scale(0.95);
      box-shadow: 0 10px 30px rgba(239, 68, 68, 0.6);
    }

    /* ========== CAMERA ========== */
    #cameraContainer {
      position: relative;
      display: none;
      margin: 24px 0;
      border-radius: 20px;
      overflow: hidden;
      border: 4px solid #fbbf24;
      box-shadow: 0 0 40px rgba(251, 191, 36, 0.5);
    }

    #cameraContainer.active {
      display: block;
    }

    #cameraView {
      width: 100%;
      display: block;
      background: #000;
    }

    #capturedCanvas {
      max-width: 100%;
      border-radius: 20px;
      margin: 24px 0;
      display: none;
      border: 4px solid #10b981;
      box-shadow: 0 0 40px rgba(16, 185, 129, 0.5);
    }

    /* ========== MESSAGGI ========== */
    .msg {
      padding: 18px 24px;
      border-radius: 16px;
      margin-bottom: 20px;
      display: none;
      font-weight: 700;
      animation: slideIn 0.4s ease;
      border: 3px solid;
      font-size: 15px;
    }

    @keyframes slideIn {
      from { opacity: 0; transform: translateX(-30px); }
      to { opacity: 1; transform: translateX(0); }
    }

    .msg.success {
      background: rgba(16, 185, 129, 0.15);
      color: #10b981;
      border-color: #10b981;
      box-shadow: 0 0 20px rgba(16, 185, 129, 0.3);
    }

    .msg.error {
      background: rgba(239, 68, 68, 0.15);
      color: #ef4444;
      border-color: #ef4444;
      box-shadow: 0 0 20px rgba(239, 68, 68, 0.3);
    }

    .msg.info {
      background: rgba(59, 130, 246, 0.15);
      color: #3b82f6;
      border-color: #3b82f6;
      box-shadow: 0 0 20px rgba(59, 130, 246, 0.3);
    }

    .info-box {
      background: rgba(59, 130, 246, 0.15);
      border: 2px solid #3b82f6;
      border-radius: 16px;
      padding: 16px 20px;
      margin-bottom: 20px;
      font-size: 14px;
      color: #60a5fa;
      font-weight: 600;
    }

    .info-box i {
      margin-right: 10px;
    }

    /* ========== MODAL GRAFICO ========== */
    .modal-graph-content {
      background: linear-gradient(135deg, #1a1a1a 0%, #0f0f0f 100%);
      border-radius: 28px;
      padding: 24px;
      max-width: 100%;
      height: calc(100% - 40px);
      overflow-y: auto;
      animation: scaleIn 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      display: flex;
      flex-direction: column;
    }

    .chart-container {
      flex: 1;
      position: relative;
      min-height: 400px;
      background: #0a0a0a;
      border-radius: 20px;
      border: 2px solid #2a2a2a;
      padding: 20px;
    }

    .chart-container canvas {
      max-height: 100%;
    }

    /* ========== WORK IN PROGRESS ========== */
    .wip-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 60px 20px;
      text-align: center;
    }

    .wip-icon {
      font-size: 80px;
      background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      animation: wipPulse 2s ease-in-out infinite;
      margin-bottom: 24px;
    }

    @keyframes wipPulse {
      0%, 100% {
        transform: scale(1);
        opacity: 1;
      }
      50% {
        transform: scale(1.1);
        opacity: 0.8;
      }
    }

    .wip-text {
      font-size: 28px;
      font-weight: 900;
      background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-transform: uppercase;
      letter-spacing: 2px;
      margin-bottom: 16px;
    }

    .wip-subtext {
      font-size: 16px;
      color: #9ca3af;
      font-weight: 600;
    }

    /* ========== FOOTER ========== */
    .page-footer {
      background: linear-gradient(135deg, #1a1a1a 0%, #0a0a0a 100%);
      padding: 40px 20px;
      margin-top: 60px;
      border-top: 3px solid #fbbf24;
      text-align: center;
      position: relative;
      z-index: 1;
    }

    .footer-logo {
      font-size: 32px;
      font-weight: 900;
      background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 16px;
    }

    .footer-text {
      color: #9ca3af;
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 24px;
    }

    .footer-social {
      display: flex;
      justify-content: center;
      gap: 16px;
    }

    .footer-social-link {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      background: linear-gradient(135deg, #1f1f1f 0%, #0f0f0f 100%);
      border: 2px solid #fbbf24;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fbbf24;
      font-size: 20px;
      transition: all 0.3s ease;
      text-decoration: none;
    }

    .footer-social-link:active {
      transform: scale(0.9);
      background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
      color: #000;
    }

    /* ========== RESPONSIVE ========== */
    @media (min-width: 768px) {
      .dashboard {
        grid-template-columns: repeat(2, 1fr);
      }

      .filter-grid {
        grid-template-columns: repeat(2, 1fr);
      }

      .articles-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (min-width: 1024px) {
      .dashboard {
        grid-template-columns: repeat(4, 1fr);
      }

      .articles-grid {
        grid-template-columns: repeat(3, 1fr);
      }
    }

    /* ========== UTILITY ========== */
    .hidden {
      display: none !important;
    }
  </style>
</head>

<body>
  <div class="particles" id="particles"></div>

  <!-- HEADER -->
  <div class="header">
    <h1>
      <div class="header-logo">
        <div class="header-logo-ring header-logo-ring-1"></div>
        <div class="header-logo-ring header-logo-ring-2"></div>
      </div>
      <span class="title-gradient">NODO</span>
    </h1>
  </div>

  <!-- MENU NAVIGAZIONE BOTTOM -->
  <div class="bottom-nav">
    <button class="menu-main-btn" id="menuBtn" onclick="toggleMenu()">
      <i class="fas fa-bars"></i>
    </button>
    <div class="menu-items" id="menuItems"></div>
  </div>

  <!-- BUTTON AGGIUNGI -->
  <div class="add-btn-container" id="addBtnContainer">
    <button class="btn-add-main" onclick="openAddModal()">
      <i class="fas fa-plus"></i>
    </button>
  </div>

  <!-- CONTENUTO PRINCIPALE -->
  <div class="main-content" id="mainContent"></div>

  <!-- FOOTER -->
  <div class="page-footer">
    <div class="footer-logo">NODO</div>
    <div class="footer-text">La tua collezione Pokémon sempre con te</div>
    <div class="footer-social">
      <a href="#" class="footer-social-link"><i class="fab fa-instagram"></i></a>
      <a href="#" class="footer-social-link"><i class="fab fa-twitter"></i></a>
      <a href="#" class="footer-social-link"><i class="fab fa-discord"></i></a>
    </div>
  </div>

  <!-- MODAL AGGIUNGI -->
  <div class="modal-add" id="modalAdd">
    <div class="modal-add-content">
      <div class="modal-header">
        <h2 class="modal-title"><i class="fas fa-plus-circle"></i> Aggiungi Articolo</h2>
        <button class="modal-close" onclick="closeAddModal()">✕</button>
      </div>

      <div id="addMsg" class="msg"></div>

      <button type="button" class="btn-scan" onclick="avviaScansione()">
        <i class="fas fa-camera-retro"></i> ⚡ SCANSIONA CARTA ⚡
      </button>

      <div id="cameraContainer">
        <video id="cameraView" autoplay playsinline></video>
      </div>
      
      <canvas id="capturedCanvas"></canvas>
      
      <div id="scanMsg" class="msg"></div>

      <div class="info-box">
        <i class="fas fa-lightbulb"></i>
        Il campo <strong>Guadagno/Perdita</strong> viene calcolato automaticamente
      </div>

      <form id="formAdd" onsubmit="aggiungiArticolo(event)">
        <div class="form-grid">
          <div class="form-group">
            <label><i class="fas fa-bolt"></i> Nome Carta *</label>
            <input type="text" name="Nome" id="nomeInput" required placeholder="Es. Charizard ex">
          </div>

          <div class="form-group">
            <label><i class="fas fa-layer-group"></i> Categoria</label>
            <input type="text" name="Categoria" id="categoriaInput" placeholder="Es. Carta Singola">
          </div>

          <div class="form-group">
            <label><i class="fas fa-scroll"></i> Descrizione / Espansione</label>
            <textarea name="Descrizione" id="descrizioneInput" placeholder="Es. SVI - 075/198"></textarea>
          </div>

          <div class="form-group">
            <label><i class="fas fa-chart-bar"></i> Valore Attuale (€) *</label>
            <input type="number" step="0.01" name="ValoreAttuale" id="valoreAttualeAdd" required placeholder="0.00" oninput="calcolaDeltaAdd()">
          </div>

          <div class="form-group">
            <label><i class="fas fa-receipt"></i> Prezzo Pagato (€) *</label>
            <input type="number" step="0.01" name="PrezzoPagato" id="prezzoPagatoAdd" required placeholder="0.00" oninput="calcolaDeltaAdd()">
          </div>

          <div class="form-group">
            <label><i class="fas fa-calculator"></i> Guadagno/Perdita (€)</label>
            <input type="number" step="0.01" name="Delta" id="deltaAdd" placeholder="0.00" readonly disabled>
          </div>

          <div class="form-group">
            <label><i class="fas fa-star-half-alt"></i> Valutazione Stato (1-10)</label>
            <input type="number" min="1" max="10" name="ValutazioneStato" id="statoAdd" placeholder="10">
          </div>

          <div class="form-group">
            <div class="checkbox-wrapper">
              <input type="checkbox" name="Presente" id="presenteAdd" checked>
              <span><i class="fas fa-box-open"></i> Articolo Presente</span>
            </div>
          </div>
        </div>

        <button type="submit" class="btn-submit">
          <i class="fas fa-plus-circle"></i> AGGIUNGI ALLA COLLEZIONE
        </button>
      </form>
    </div>
  </div>

  <!-- MODAL MODIFICA -->
  <div class="modal-edit" id="modalEdit">
    <div class="modal-edit-content">
      <div class="modal-header">
        <h2 class="modal-title"><i class="fas fa-edit"></i> Modifica Articolo</h2>
        <button class="modal-close" onclick="closeEditModal()">✕</button>
      </div>

      <div id="editMsg" class="msg"></div>

      <div class="info-box">
        <i class="fas fa-lightbulb"></i>
        Il campo <strong>Guadagno/Perdita</strong> viene calcolato automaticamente
      </div>

      <form id="formEdit" onsubmit="salvaModifica(event)">
        <input type="hidden" id="editId">
        
        <div class="form-grid">
          <div class="form-group">
            <label><i class="fas fa-bolt"></i> Nome *</label>
            <input type="text" id="editNome" name="Nome" required>
          </div>

          <div class="form-group">
            <label><i class="fas fa-layer-group"></i> Categoria</label>
            <input type="text" id="editCategoria" name="Categoria">
          </div>

          <div class="form-group">
            <label><i class="fas fa-scroll"></i> Descrizione</label>
            <textarea id="editDescrizione" name="Descrizione"></textarea>
          </div>

          <div class="form-group">
            <label><i class="fas fa-chart-bar"></i> Valore Attuale (€) *</label>
            <input type="number" step="0.01" id="editValoreAttuale" name="ValoreAttuale" required oninput="calcolaDeltaEdit()">
          </div>

          <div class="form-group">
            <label><i class="fas fa-receipt"></i> Prezzo Pagato (€) *</label>
            <input type="number" step="0.01" id="editPrezzoPagato" name="PrezzoPagato" required oninput="calcolaDeltaEdit()">
          </div>

          <div class="form-group">
            <label><i class="fas fa-calculator"></i> Guadagno/Perdita (€)</label>
            <input type="number" step="0.01" id="editDelta" name="Delta" readonly disabled>
          </div>

          <div class="form-group">
            <label><i class="fas fa-star-half-alt"></i> Valutazione Stato (1-10)</label>
            <input type="number" min="1" max="10" id="editStato" name="ValutazioneStato">
          </div>

          <div class="form-group">
            <div class="checkbox-wrapper">
              <input type="checkbox" id="editPresente" name="Presente">
              <span><i class="fas fa-box-open"></i> Articolo Presente</span>
            </div>
          </div>
        </div>

        <button type="submit" class="btn-submit">
          <i class="fas fa-save"></i> SALVA MODIFICHE
        </button>

        <button type="button" class="btn-delete" onclick="eliminaArticolo()">
          <i class="fas fa-trash-alt"></i> ELIMINA ARTICOLO
        </button>
      </form>
    </div>
  </div>

  <!-- MODAL GRAFICO -->
  <div class="modal-graph" id="modalGraph">
    <div class="modal-graph-content">
      <div class="modal-header">
        <h2 class="modal-title" id="graphTitle"><i class="fas fa-chart-area"></i> Statistiche</h2>
        <button class="modal-close" onclick="closeGraphModal()">✕</button>
      </div>
      
      <div class="chart-container">
        <canvas id="chartCanvas"></canvas>
      </div>
    </div>
  </div>

<!-- FINE PARTE 2 - Continua con PARTE 3 -->









<!-- ========================================= -->
<!-- PARTE 3 DI 4 - VERSIONE FINALE CON TUTTE LE MODIFICHE -->
<!-- ========================================= -->

  <script>
    // ========== CONFIGURAZIONE SUPABASE ==========
     const SUPABASE_URL = "https://xoagoblnzvdqnktpfhlk.supabase.co";
    const SUPABASE_ANON_KEY = "sb_publishable_Uf5-1uzQzL-OqI6dA-tl_g_RHpYxNds";
    const client = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // ========== VARIABILI GLOBALI ==========
    let currentPage = 1;
    const itemsPerPage = 10;
    let allArticles = [];
    let filteredArticles = [];
    let currentChart = null;
    let currentChartColor = 'yellow';
    let stream = null;
    let menuOpen = false;
    let currentView = 'archivio';
    let currentSubmenu = null;

    // ========== DATABASE POKEMON ==========
    const POKEMON_DATABASE = {
      'SVI': { nome: 'Scarlatto e Violetto Base', max: 198 },
      'PAL': { nome: 'Paldea Evolved', max: 279 },
      'OBF': { nome: 'Obsidian Flames', max: 230 },
      'PAR': { nome: 'Paradox Rift', max: 266 },
      'PAF': { nome: 'Paldean Fates', max: 245 },
      'TEF': { nome: 'Temporal Forces', max: 218 },
      'TWM': { nome: 'Twilight Masquerade', max: 226 },
      'SHR': { nome: 'Shrouded Fable', max: 99 },
      'SCR': { nome: 'Stellar Crown', max: 175 },
      'SSP': { nome: 'Surging Sparks', max: 252 },
      nomiComuni: [
        'Pikachu', 'Charizard', 'Mewtwo', 'Mew', 'Lucario', 'Greninja', 
        'Rayquaza', 'Garchomp', 'Gardevoir', 'Umbreon', 'Espeon', 'Eevee',
        'Snorlax', 'Dragonite', 'Gyarados', 'Gengar', 'Alakazam', 'Machamp',
        'Blastoise', 'Venusaur', 'Zapdos', 'Articuno', 'Moltres', 'Lugia'
      ]
    };

    // ========== MENU NAVIGAZIONE (AGGIORNATO) ==========
    const menuStructure = {
      archivio: {
        icon: 'fas fa-archive',
        label: 'Archivio',
        action: () => loadView('archivio')
      },
      mancoliste: {
        icon: 'fas fa-list-check',
        label: 'Mancoliste',
        action: () => loadView('mancoliste')
      },
      vetrine: {
        icon: 'fas fa-shop',
        label: 'Vetrine',
        action: () => loadView('vetrine')
      },
      community: {
        icon: 'fas fa-users',
        label: 'Community',
        action: () => loadView('community')
      },
      profilo: {
        icon: 'fas fa-user',
        label: 'Profilo',
        submenu: {
          modifica_profilo: {
            icon: 'fas fa-user-edit',
            label: 'Modifica Profilo',
            action: () => loadView('modifica-profilo')
          },
          tuo_negozio: {
            icon: 'fas fa-store',
            label: 'Il tuo negozio',
            submenu: {
              vetrina: { icon: 'fas fa-shop-lock', label: 'Vetrina', action: () => loadView('vetrina-negozio') },
              mancolista: { icon: 'fas fa-list-ul', label: 'Mancolista', action: () => loadView('mancolista-negozio') },
              analisi: { icon: 'fas fa-chart-line', label: 'Analisi di mercato', action: () => loadView('analisi-mercato') },
              promozioni: { icon: 'fas fa-tag', label: 'Promozioni', action: () => loadView('promozioni') },
              indietro: { icon: 'fas fa-arrow-left', label: 'Indietro', action: () => loadSubmenu('profilo') },
              home: { icon: 'fas fa-home', label: 'Torna alla home', action: () => loadView('archivio') }
            }
          },
          indietro: { icon: 'fas fa-arrow-left', label: 'Indietro', action: () => { loadMenu(); currentSubmenu = null; } },
          home: { icon: 'fas fa-home', label: 'Torna alla home', action: () => loadView('archivio') }
        }
      }
    };

    function toggleMenu() {
      menuOpen = !menuOpen;
      const menuBtn = document.getElementById('menuBtn');
      const menuItems = document.getElementById('menuItems');
      
      menuBtn.classList.toggle('active');
      
      if (menuOpen) {
        loadMenu();
      } else {
        menuItems.innerHTML = '';
      }
    }

    function loadMenu() {
      const menuItems = document.getElementById('menuItems');
      menuItems.innerHTML = '';
      
      const items = Object.entries(menuStructure);
      
      items.forEach(([key, item], index) => {
        const menuItem = document.createElement('div');
        menuItem.className = 'menu-item';
        
        const yOffset = 80 * (index + 1);
        
        setTimeout(() => {
          menuItem.classList.add('active');
          menuItem.style.transform = `translateY(-${yOffset}px)`;
        }, index * 50);
        
        menuItem.innerHTML = `
          <i class="${item.icon}"></i>
          <div class="menu-label">${item.label}</div>
        `;
        
        menuItem.onclick = () => {
          if (item.submenu) {
            loadSubmenu(key);
          } else if (item.action) {
            item.action();
            toggleMenu();
          }
        };
        
        menuItems.appendChild(menuItem);
      });
    }

    function loadSubmenu(menuKey) {
      const menuItems = document.getElementById('menuItems');
      menuItems.innerHTML = '';
      currentSubmenu = menuKey;
      
      const submenu = menuStructure[menuKey].submenu;
      const items = Object.entries(submenu);
      
      items.forEach(([key, item], index) => {
        const menuItem = document.createElement('div');
        menuItem.className = 'menu-item';
        
        const yOffset = 80 * (index + 1);
        
        setTimeout(() => {
          menuItem.classList.add('active');
          menuItem.style.transform = `translateY(-${yOffset}px)`;
        }, index * 50);
        
        menuItem.innerHTML = `
          <i class="${item.icon}"></i>
          <div class="menu-label">${item.label}</div>
        `;
        
        menuItem.onclick = () => {
          if (item.submenu) {
            loadSubmenu(key);
          } else if (item.action) {
            item.action();
            if (key !== 'indietro') {
              toggleMenu();
            }
          }
        };
        
        menuItems.appendChild(menuItem);
      });
    }

    // ========== VIEWS ==========
    function loadView(viewName) {
      currentView = viewName;
      window.scrollTo({ top: 0, behavior: 'smooth' });
      
      switch(viewName) {
        case 'archivio':
          loadArchivioView();
          break;
        case 'mancoliste':
          loadMancolisteView();
          break;
        case 'vetrine':
          loadVetrineView();
          break;
        case 'community':
          loadCommunityView();
          break;
        case 'modifica-profilo':
        case 'vetrina-negozio':
        case 'mancolista-negozio':
        case 'analisi-mercato':
        case 'promozioni':
          loadWIPView(viewName);
          break;
      }
    }

    function loadWIPView(viewName) {
      const mainContent = document.getElementById('mainContent');
      
      // NASCONDI PULSANTE AGGIUNGI
      document.getElementById('addBtnContainer').classList.remove('visible');
      
      // Pagine complete
      if (viewName === 'modifica-profilo') {
        loadModificaProfiloPage();
        return;
      }
      
      if (viewName === 'vetrina-negozio' || viewName === 'mancolista-negozio' || 
          viewName === 'analisi-mercato' || viewName === 'promozioni') {
        loadTuoNegozioPage(viewName);
        return;
      }
      
      // Default WIP per altre pagine
      const labels = {
        'modifica-profilo': 'Modifica Profilo',
        'vetrina-negozio': 'Vetrina',
        'mancolista-negozio': 'Mancolista',
        'analisi-mercato': 'Analisi di mercato',
        'promozioni': 'Promozioni'
      };
      
      mainContent.innerHTML = `
        <div class="wip-container">
          <div class="wip-icon">
            <i class="fas fa-hammer"></i>
          </div>
          <div class="wip-text">Work in Progress</div>
          <div class="wip-subtext">${labels[viewName]} - In arrivo presto!</div>
        </div>
      `;
    }
    
    // ========== MODIFICA PROFILO ==========
    function loadModificaProfiloPage() {
      const mainContent = document.getElementById('mainContent');
      mainContent.innerHTML = `
        <style>
          .profile-page {
            padding: 20px;
            max-width: 600px;
            margin: 0 auto;
          }
          
          .profile-header {
            text-align: center;
            margin-bottom: 32px;
          }
          
          .profile-avatar-big {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            border: 4px solid #10b981;
            margin: 0 auto 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            color: #000;
            font-weight: 900;
            cursor: pointer;
            transition: all 0.3s;
          }
          
          .profile-avatar-big:active {
            transform: scale(0.95);
          }
          
          .change-avatar-btn {
            color: #10b981;
            font-size: 14px;
            font-weight: 700;
            cursor: pointer;
            text-decoration: underline;
          }
          
          .profile-form {
            background: linear-gradient(135deg, #1a1a1a 0%, #0f0f0f 100%);
            border-radius: 24px;
            padding: 28px;
            border: 2px solid #10b981;
          }
          
          .profile-section {
            margin-bottom: 24px;
          }
          
          .profile-section h3 {
            color: #fbbf24;
            font-size: 18px;
            margin-bottom: 16px;
            font-weight: 800;
            display: flex;
            align-items: center;
            gap: 8px;
          }
          
          .btn-save-profile {
            width: 100%;
            padding: 18px;
            border-radius: 16px;
            border: none;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: #fff;
            font-size: 16px;
            font-weight: 800;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 8px;
          }
          
          .btn-save-profile:active {
            transform: scale(0.95);
          }
        </style>
        
        <div class="profile-page">
          <div class="profile-header">
            <div class="profile-avatar-big" onclick="alert('📷 Cambio foto: Funzione in arrivo!')">
              <i class="fas fa-user"></i>
            </div>
            <div class="change-avatar-btn" onclick="alert('📷 Cambio foto: Funzione in arrivo!')">
              Cambia foto profilo
            </div>
          </div>
          
          <div class="profile-form">
            <div class="profile-section">
              <h3><i class="fas fa-user-circle"></i> Informazioni Personali</h3>
              <div class="form-grid">
                <div class="form-group">
                  <label><i class="fas fa-signature"></i> Nome Utente</label>
                  <input type="text" value="CollectorePro" placeholder="Il tuo nickname">
                </div>
                
                <div class="form-group">
                  <label><i class="fas fa-envelope"></i> Email</label>
                  <input type="email" value="collector@pokemon.it" placeholder="email@example.com">
                </div>
                
                <div class="form-group">
                  <label><i class="fas fa-map-marker-alt"></i> Città</label>
                  <input type="text" value="Milano" placeholder="La tua città">
                </div>
              </div>
            </div>
            
            <div class="profile-section">
              <h3><i class="fas fa-cog"></i> Preferenze</h3>
              <div class="form-grid">
                <div class="form-group">
                  <div class="checkbox-wrapper">
                    <input type="checkbox" id="notifiche" checked>
                    <span><i class="fas fa-bell"></i> Notifiche email</span>
                  </div>
                </div>
                
                <div class="form-group">
                  <div class="checkbox-wrapper">
                    <input type="checkbox" id="newsletter" checked>
                    <span><i class="fas fa-newspaper"></i> Newsletter settimanale</span>
                  </div>
                </div>
                
                <div class="form-group">
                  <div class="checkbox-wrapper">
                    <input type="checkbox" id="pubblico">
                    <span><i class="fas fa-users"></i> Profilo pubblico</span>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="profile-section">
              <h3><i class="fas fa-info-circle"></i> Bio</h3>
              <div class="form-group">
                <textarea placeholder="Racconta qualcosa di te e della tua collezione..." style="min-height: 120px;">Collezionista appassionato dal 1999! Amo le carte vintage e le espansioni giapponesi. Sempre disponibile per scambi!</textarea>
              </div>
            </div>
            
            <button class="btn-save-profile" onclick="alert('💾 Profilo salvato con successo!')">
              <i class="fas fa-save"></i> SALVA MODIFICHE
            </button>
          </div>
        </div>
      `;
    }
    
    // ========== IL TUO NEGOZIO ==========
    function loadTuoNegozioPage(section) {
      const mainContent = document.getElementById('mainContent');
      
      const sections = {
        'vetrina-negozio': { icon: 'shop-lock', title: 'La Tua Vetrina', desc: 'Gestisci i tuoi articoli in vendita' },
        'mancolista-negozio': { icon: 'list-ul', title: 'Mancolista Negozio', desc: 'Articoli che cerchi per il tuo stock' },
        'analisi-mercato': { icon: 'chart-line', title: 'Analisi di Mercato', desc: 'Statistiche e trend di vendita' },
        'promozioni': { icon: 'tag', title: 'Promozioni', desc: 'Crea offerte speciali per i clienti' }
      };
      
      const current = sections[section];
      
      mainContent.innerHTML = `
        <style>
          .shop-page {
            padding: 20px;
          }
          
          .shop-header {
            background: linear-gradient(135deg, #1a1a1a 0%, #0f0f0f 100%);
            border-radius: 24px;
            padding: 24px;
            margin-bottom: 24px;
            border: 3px solid #fbbf24;
          }
          
          .shop-header h2 {
            color: #fbbf24;
            font-size: 24px;
            font-weight: 900;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 12px;
          }
          
          .shop-header p {
            color: #9ca3af;
            font-size: 14px;
          }
          
          .shop-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-bottom: 24px;
          }
          
          .shop-stat-card {
            background: linear-gradient(135deg, #1f1f1f 0%, #1a1a1a 100%);
            border-radius: 20px;
            padding: 20px;
            border: 2px solid #2a2a2a;
          }
          
          .shop-stat-icon {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-size: 20px;
            margin-bottom: 12px;
          }
          
          .shop-stat-value {
            font-size: 28px;
            font-weight: 900;
            color: #fbbf24;
            margin-bottom: 4px;
          }
          
          .shop-stat-label {
            font-size: 13px;
            color: #9ca3af;
            text-transform: uppercase;
            font-weight: 700;
          }
          
          .shop-actions {
            display: grid;
            gap: 12px;
          }
          
          .shop-action-btn {
            padding: 18px;
            border-radius: 16px;
            border: 2px solid #10b981;
            background: #0a0a0a;
            color: #e5e7eb;
            font-size: 15px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 12px;
          }
          
          .shop-action-btn i {
            color: #10b981;
            font-size: 18px;
          }
          
          .shop-action-btn:active {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: #000;
            transform: scale(0.98);
          }
          
          .shop-action-btn:active i {
            color: #000;
          }
        </style>
        
        <div class="shop-page">
          <div class="shop-header">
            <h2>
              <i class="fas fa-${current.icon}"></i>
              ${current.title}
            </h2>
            <p>${current.desc}</p>
          </div>
          
          <div class="shop-stats">
            <div class="shop-stat-card">
              <div class="shop-stat-icon"><i class="fas fa-box"></i></div>
              <div class="shop-stat-value">127</div>
              <div class="shop-stat-label">Articoli attivi</div>
            </div>
            
            <div class="shop-stat-card">
              <div class="shop-stat-icon"><i class="fas fa-chart-line"></i></div>
              <div class="shop-stat-value">3.456€</div>
              <div class="shop-stat-label">Valore totale</div>
            </div>
            
            <div class="shop-stat-card">
              <div class="shop-stat-icon"><i class="fas fa-users"></i></div>
              <div class="shop-stat-value">89</div>
              <div class="shop-stat-label">Clienti attivi</div>
            </div>
            
            <div class="shop-stat-card">
              <div class="shop-stat-icon"><i class="fas fa-star"></i></div>
              <div class="shop-stat-value">4.8</div>
              <div class="shop-stat-label">Valutazione media</div>
            </div>
          </div>
          
          <div class="shop-actions">
            <button class="shop-action-btn" onclick="alert('➕ Aggiungi articolo: Funzione in arrivo!')">
              <i class="fas fa-plus-circle"></i>
              <span>Aggiungi nuovo articolo in vendita</span>
            </button>
            
            <button class="shop-action-btn" onclick="alert('📊 Report: Funzione in arrivo!')">
              <i class="fas fa-file-chart-line"></i>
              <span>Visualizza report vendite</span>
            </button>
            
            <button class="shop-action-btn" onclick="alert('💬 Messaggi: Funzione in arrivo!')">
              <i class="fas fa-messages"></i>
              <span>Messaggi clienti (3 nuovi)</span>
            </button>
            
            <button class="shop-action-btn" onclick="alert('⚙️ Impostazioni: Funzione in arrivo!')">
              <i class="fas fa-gear"></i>
              <span>Impostazioni negozio</span>
            </button>
          </div>
        </div>
      `;
    }

    // ========== MANCOLISTE VIEW (ALBUM ANIMATO) ==========
    let albumCurrentExpansion = 0;
    const albumExpansions = [
      { code: 'SVI', name: 'Scarlatto e Violetto', cards: ['Pikachu', 'Charizard', 'Mewtwo', 'Mew', 'Lucario', 'Greninja'] },
      { code: 'PAL', name: 'Paldea Evolved', cards: ['Rayquaza', 'Garchomp', 'Gardevoir', 'Umbreon', 'Espeon', 'Eevee'] },
      { code: 'OBF', name: 'Obsidian Flames', cards: ['Snorlax', 'Dragonite', 'Gyarados', 'Gengar', 'Alakazam', 'Machamp'] },
      { code: 'PAR', name: 'Paradox Rift', cards: ['Blastoise', 'Venusaur', 'Zapdos', 'Articuno', 'Moltres', 'Lugia'] },
      { code: 'TEF', name: 'Temporal Forces', cards: ['Ho-Oh', 'Celebi', 'Jirachi', 'Deoxys', 'Latias', 'Latios'] }
    ];
    
    function loadMancolisteView() {
      document.getElementById('addBtnContainer').classList.remove('visible');
      
      const mainContent = document.getElementById('mainContent');
      mainContent.innerHTML = `
        <style>
          .mancoliste-container {
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
          }
          
          .mancoliste-header {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 16px;
            margin-bottom: 24px;
          }
          
          .nodo-logo {
            width: 60px;
            height: 60px;
            position: relative;
          }
          
          .nodo-ring {
            position: absolute;
            border: 4px solid #fbbf24;
            border-radius: 50%;
            box-shadow: 0 0 20px rgba(251, 191, 36, 0.5);
          }
          
          .nodo-ring-1 {
            width: 50px;
            height: 35px;
            top: 12px;
            left: 0;
            transform: rotate(-20deg);
            animation: ring1pulse 3s ease-in-out infinite;
          }
          
          .nodo-ring-2 {
            width: 50px;
            height: 35px;
            top: 12px;
            right: 0;
            transform: rotate(20deg);
            animation: ring2pulse 3s ease-in-out infinite;
          }
          
          @keyframes ring1pulse {
            0%, 100% { transform: rotate(-20deg) scale(1); }
            50% { transform: rotate(-20deg) scale(1.05); }
          }
          
          @keyframes ring2pulse {
            0%, 100% { transform: rotate(20deg) scale(1); }
            50% { transform: rotate(20deg) scale(1.05); }
          }
          
          .mancoliste-title {
            font-size: 32px;
            font-weight: 900;
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-transform: uppercase;
            letter-spacing: 2px;
          }
          
          .expansions-list {
            display: flex;
            gap: 12px;
            padding: 16px;
            background: linear-gradient(135deg, #1a1a1a 0%, #0f0f0f 100%);
            border-radius: 20px;
            border: 2px solid #2a2a2a;
            margin-bottom: 20px;
            overflow-x: auto;
            flex-wrap: wrap;
            justify-content: center;
          }
          
          .expansion-chip {
            padding: 8px 16px;
            border-radius: 12px;
            border: 2px solid #2a2a2a;
            background: #0a0a0a;
            color: #9ca3af;
            font-size: 13px;
            font-weight: 700;
            white-space: nowrap;
            transition: all 0.3s;
          }
          
          .expansion-chip.active {
            border-color: #fbbf24;
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            color: #000;
            box-shadow: 0 0 20px rgba(251, 191, 36, 0.4);
          }
          
          .mancoliste-filter-box {
            background: linear-gradient(135deg, #1a1a1a 0%, #0f0f0f 100%);
            border-radius: 24px;
            border: 2px solid #2a2a2a;
            margin-bottom: 20px;
            overflow: hidden;
          }
          
          .album-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 40px 20px;
            min-height: 400px;
            justify-content: center;
          }
          
          .expansion-nav {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
            width: 100%;
            max-width: 500px;
          }
          
          .expansion-nav-btn {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            border: 3px solid #fbbf24;
            background: linear-gradient(135deg, #1a1a1a 0%, #0f0f0f 100%);
            color: #fbbf24;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
          }
          
          .expansion-nav-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
            border-color: #2a2a2a;
            color: #6b7280;
          }
          
          .expansion-nav-btn:not(:disabled):active {
            transform: scale(0.9);
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            color: #000;
          }
          
          .expansion-nav-title {
            flex: 1;
            text-align: center;
            font-size: 20px;
            font-weight: 900;
            color: #fbbf24;
          }
          
          .album-book {
            position: relative;
            width: 300px;
            height: 400px;
            perspective: 1500px;
            animation: albumGrow 1.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
          }
          
          @keyframes albumGrow {
            0% { transform: scale(0.3); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
          }
          
          .album-cover {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(251, 191, 36, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            font-weight: 900;
            color: #000;
            cursor: pointer;
            transition: transform 0.3s;
            border: 4px solid #000;
          }
          
          .album-cover:active {
            transform: scale(1.05);
          }
          
          .album-pages {
            display: none;
            width: 100%;
            max-width: 400px;
            background: linear-gradient(135deg, #1a1a1a 0%, #0f0f0f 100%);
            border-radius: 12px;
            border: 4px solid #fbbf24;
            padding: 30px 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8);
            animation: pageOpen 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55);
          }
          
          @keyframes pageOpen {
            0% { opacity: 0; transform: rotateY(-90deg); }
            100% { opacity: 1; transform: rotateY(0); }
          }
          
          .album-pages.active {
            display: block;
          }
          
          .cards-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
          }
          
          .card-slot {
            aspect-ratio: 2/3;
            background: linear-gradient(135deg, #2a2a2a 0%, #1a1a1a 100%);
            border-radius: 8px;
            border: 2px solid #fbbf24;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            color: #fbbf24;
            font-weight: 700;
            text-align: center;
            padding: 5px;
            transition: transform 0.3s;
            animation: cardPop 0.5s ease;
          }
          
          @keyframes cardPop {
            0% { transform: scale(0); opacity: 0; }
            80% { transform: scale(1.1); }
            100% { transform: scale(1); opacity: 1; }
          }
          
          .card-slot:nth-child(1) { animation-delay: 0.1s; }
          .card-slot:nth-child(2) { animation-delay: 0.2s; }
          .card-slot:nth-child(3) { animation-delay: 0.3s; }
          .card-slot:nth-child(4) { animation-delay: 0.4s; }
          .card-slot:nth-child(5) { animation-delay: 0.5s; }
          .card-slot:nth-child(6) { animation-delay: 0.6s; }
          
          .album-nav {
            display: flex;
            justify-content: space-between;
            gap: 12px;
          }
          
          .album-nav-btn {
            flex: 1;
            padding: 12px;
            border-radius: 12px;
            border: 2px solid #fbbf24;
            background: #0a0a0a;
            color: #fbbf24;
            font-size: 14px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
          }
          
          .album-nav-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
          }
          
          .album-nav-btn:not(:disabled):active {
            transform: scale(0.95);
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            color: #000;
          }
          
          .page-indicator {
            text-align: center;
            margin: 20px 0;
            font-weight: 700;
            color: #fbbf24;
            font-size: 16px;
          }
        </style>
        
        <div class="mancoliste-container">
          <div class="mancoliste-header">
            <div class="nodo-logo">
              <div class="nodo-ring nodo-ring-1"></div>
              <div class="nodo-ring nodo-ring-2"></div>
            </div>
            <div class="mancoliste-title">Mancoliste</div>
          </div>
          
          <div class="expansions-list">
            ${albumExpansions.map((exp, i) => `
              <div class="expansion-chip ${i === albumCurrentExpansion ? 'active' : ''}" 
                   onclick="changeExpansion(${i})">
                ${exp.code} - ${exp.name}
              </div>
            `).join('')}
          </div>
          
          <div class="mancoliste-filter-box">
            <div class="filter-header" style="padding: 20px; cursor: pointer;" onclick="toggleMancolisteFilters()">
              <div class="filter-title">
                <i class="fas fa-sliders-h"></i>
                FILTRI RICERCA
              </div>
            </div>
            
            <div class="filter-content" id="mancolisteFilterContent" style="padding: 0 20px 20px; display: none;">
              <div class="filter-grid">
                <div class="filter-group">
                  <label><i class="fas fa-search"></i> Cerca Carta</label>
                  <input type="text" id="fMancolistaNome" placeholder="Es. Charizard, Pikachu...">
                </div>
                
                <div class="filter-group">
                  <label><i class="fas fa-hashtag"></i> Numero Carta</label>
                  <input type="text" id="fMancolistaNumero" placeholder="Es. 001, 025...">
                </div>
              </div>
              
              <div class="toggle-group" style="margin-top: 16px;">
                <div class="toggle-option">
                  <input type="checkbox" id="fMancolistaPossedute" checked>
                  <label for="fMancolistaPossedute" class="toggle-label">
                    <i class="fas fa-check-circle"></i>
                    POSSEDUTE
                  </label>
                </div>
                
                <div class="toggle-option">
                  <input type="checkbox" id="fMancolistaMancanti" checked>
                  <label for="fMancolistaMancanti" class="toggle-label">
                    <i class="fas fa-times-circle"></i>
                    MANCANTI
                  </label>
                </div>
              </div>
            </div>
          </div>
          
          <div class="album-section">
            <div class="expansion-nav">
              <button class="expansion-nav-btn" id="prevExpansion" onclick="prevExpansion()">
                <i class="fas fa-chevron-left"></i>
              </button>
              <div class="expansion-nav-title" id="currentExpansionTitle">
                ${albumExpansions[0].code} - ${albumExpansions[0].name}
              </div>
              <button class="expansion-nav-btn" id="nextExpansion" onclick="nextExpansion()">
                <i class="fas fa-chevron-right"></i>
              </button>
            </div>
            
            <div class="album-book" id="albumBook">
              <div class="album-cover" onclick="openAlbum()">
                <div>
                  <i class="fas fa-book"></i><br>
                  <div style="font-size: 16px; margin-top: 10px;">APRI<br>ALBUM</div>
                </div>
              </div>
            </div>
            
            <div class="album-pages" id="albumPages">
              <div class="page-indicator" id="pageIndicator">Pagina 1</div>
              <div class="cards-grid" id="cardsGrid"></div>
              <div class="album-nav">
                <button class="album-nav-btn" id="prevPage" onclick="prevAlbumPage()">
                  <i class="fas fa-chevron-left"></i> PRECEDENTE
                </button>
                <button class="album-nav-btn" id="nextPage" onclick="nextAlbumPage()">
                  SUCCESSIVA <i class="fas fa-chevron-right"></i>
                </button>
              </div>
            </div>
          </div>
        </div>
      `;
      
      updateExpansionNav();
    }
    
    function toggleMancolisteFilters() {
      const content = document.getElementById('mancolisteFilterContent');
      if (content.style.display === 'none') {
        content.style.display = 'block';
      } else {
        content.style.display = 'none';
      }
    }
    
    function changeExpansion(index) {
      albumCurrentExpansion = index;
      loadMancolisteView();
    }
    
    function prevExpansion() {
      if (albumCurrentExpansion > 0) {
        albumCurrentExpansion--;
        updateExpansionDisplay();
      }
    }
    
    function nextExpansion() {
      if (albumCurrentExpansion < albumExpansions.length - 1) {
        albumCurrentExpansion++;
        updateExpansionDisplay();
      }
    }
    
    function updateExpansionDisplay() {
      const exp = albumExpansions[albumCurrentExpansion];
      document.getElementById('currentExpansionTitle').textContent = `${exp.code} - ${exp.name}`;
      
      // Aggiorna chip attivi
      const chips = document.querySelectorAll('.expansion-chip');
      chips.forEach((chip, i) => {
        if (i === albumCurrentExpansion) {
          chip.classList.add('active');
        } else {
          chip.classList.remove('active');
        }
      });
      
      updateExpansionNav();
      
      // Se l'album è aperto, aggiorna le carte
      if (document.getElementById('albumPages').classList.contains('active')) {
        albumCurrentPage = 1;
        renderAlbumPage();
      }
    }
    
    function updateExpansionNav() {
      const prevBtn = document.getElementById('prevExpansion');
      const nextBtn = document.getElementById('nextExpansion');
      
      if (prevBtn) prevBtn.disabled = albumCurrentExpansion === 0;
      if (nextBtn) nextBtn.disabled = albumCurrentExpansion === albumExpansions.length - 1;
    }

    let albumCurrentPage = 1;
    const cardsPerPage = 6;

    function openAlbum() {
      document.querySelector('.album-cover').style.display = 'none';
      document.getElementById('albumPages').classList.add('active');
      albumCurrentPage = 1;
      renderAlbumPage();
    }

    function renderAlbumPage() {
      const grid = document.getElementById('cardsGrid');
      const exp = albumExpansions[albumCurrentExpansion];
      const totalCards = exp.cards.length;
      const totalPages = Math.ceil(totalCards / cardsPerPage);
      
      const start = (albumCurrentPage - 1) * cardsPerPage;
      const end = start + cardsPerPage;
      const pageCards = exp.cards.slice(start, end);
      
      grid.innerHTML = pageCards.map(card => `
        <div class="card-slot">
          <div>${card}</div>
        </div>
      `).join('');
      
      document.getElementById('pageIndicator').textContent = `Pagina ${albumCurrentPage} di ${totalPages}`;
      document.getElementById('prevPage').disabled = albumCurrentPage === 1;
      document.getElementById('nextPage').disabled = albumCurrentPage === totalPages;
    }

    function prevAlbumPage() {
      if (albumCurrentPage > 1) {
        albumCurrentPage--;
        renderAlbumPage();
      }
    }

    function nextAlbumPage() {
      const exp = albumExpansions[albumCurrentExpansion];
      const totalPages = Math.ceil(exp.cards.length / cardsPerPage);
      if (albumCurrentPage < totalPages) {
        albumCurrentPage++;
        renderAlbumPage();
      }
    }

    // ========== VETRINE VIEW ==========
    let expandedShowcases = [];
    
    function loadVetrineView() {
      document.getElementById('addBtnContainer').classList.remove('visible');
      
      const mainContent = document.getElementById('mainContent');
      mainContent.innerHTML = `
        <style>
          .vetrine-grid {
            display: grid;
            gap: 20px;
            padding: 20px;
          }
          
          .vetrina-card-big {
            background: linear-gradient(135deg, #1a1a1a 0%, #0f0f0f 100%);
            border-radius: 24px;
            border: 2px solid #fbbf24;
            overflow: hidden;
            transition: all 0.4s;
          }
          
          .vetrina-header {
            padding: 24px;
            cursor: pointer;
            border-bottom: 2px solid #2a2a2a;
          }
          
          .vetrina-card-big:not(.expanded) .vetrina-header:hover {
            background: #1f1f1f;
          }
          
          .vetrina-top {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 16px;
          }
          
          .vetrina-avatar {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            border: 3px solid #10b981;
            flex-shrink: 0;
          }
          
          .vetrina-info {
            flex: 1;
          }
          
          .vetrina-info h3 {
            color: #fbbf24;
            font-size: 20px;
            margin-bottom: 6px;
            font-weight: 800;
            display: flex;
            justify-content: space-between;
            align-items: center;
          }
          
          .vetrina-expand-icon {
            font-size: 16px;
            transition: transform 0.3s;
          }
          
          .vetrina-card-big.expanded .vetrina-expand-icon {
            transform: rotate(180deg);
          }
          
          .vetrina-info p {
            color: #9ca3af;
            font-size: 14px;
            margin-bottom: 4px;
          }
          
          .vetrina-rating {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #fbbf24;
            font-size: 14px;
            font-weight: 700;
          }
          
          .vetrina-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            padding: 0 24px 24px;
          }
          
          .vetrina-stat {
            text-align: center;
            padding: 12px;
            background: #0a0a0a;
            border-radius: 12px;
            border: 2px solid #2a2a2a;
          }
          
          .vetrina-stat-value {
            font-size: 20px;
            font-weight: 900;
            color: #10b981;
            margin-bottom: 4px;
          }
          
          .vetrina-stat-label {
            font-size: 11px;
            color: #6b7280;
            text-transform: uppercase;
            font-weight: 700;
          }
          
          .vetrina-items-preview {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 12px;
            padding: 0 24px 24px;
          }
          
          .vetrina-item {
            aspect-ratio: 2/3;
            background: #2a2a2a;
            border-radius: 8px;
            border: 2px solid #10b981;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            color: #9ca3af;
            text-align: center;
            padding: 8px;
            transition: all 0.3s;
          }
          
          .vetrina-item:active {
            transform: scale(0.95);
            border-color: #fbbf24;
          }
          
          .vetrina-details {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease;
          }
          
          .vetrina-card-big.expanded .vetrina-details {
            max-height: 2000px;
          }
          
          .vetrina-full-catalog {
            padding: 20px 24px 24px;
            background: #0a0a0a;
          }
          
          .vetrina-full-catalog h4 {
            color: #fbbf24;
            font-size: 18px;
            margin-bottom: 16px;
            font-weight: 800;
          }
          
          .vetrina-catalog-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 12px;
          }
        </style>
        
        <div class="vetrine-grid">
          ${createShowcaseCard(1, 'Pokemon Master Shop', 'Carte rare e vintage dal 1999', 4.8, 156, 1240, 89, 
            ['Charizard Base Set', 'Pikachu 1st Ed', 'Mewtwo EX', 'Lugia Legend', 'Rayquaza VMAX', 'Umbreon GX'])}
          
          ${createShowcaseCard(2, 'Collezionista Pro', 'Espansioni moderne e sealed', 4.9, 203, 890, 95,
            ['ETB Surging Sparks', 'Booster TEF', 'Tin Box Charizard', 'Elite Trainer Box', 'Premium Collection', 'Battle Deck'])}
          
          ${createShowcaseCard(3, 'Tokyo Cards Italia', 'Import esclusivo dal Giappone', 4.7, 98, 560, 78,
            ['Carte JAP Promo', 'Sleeves Limited', 'Deck Box Tokyo', 'Play Mat Exclusive', 'Binder Premium', 'Card Case'])}
          
          ${createShowcaseCard(4, 'Vintage Pokémon', 'Nostalgia anni 90 e 2000', 5.0, 67, 2100, 100,
            ['Base Set Holo', 'Fossil Rare', 'Jungle 1st', 'Neo Genesis', 'Team Rocket', 'Gym Heroes'])}
          
          ${createShowcaseCard(5, 'Competitive TCG', 'Carte competitive per tornei', 4.6, 189, 430, 82,
            ['Meta Deck Cards', 'Tournament Ready', 'Staple Trainers', 'Energy Full Art', 'ACE SPEC', 'Supporter SR'])}
        </div>
      `;
    }
    
    function createShowcaseCard(id, shopName, description, rating, reviews, articles, satisfaction, items) {
      const isExpanded = expandedShowcases.includes(id);
      const previewItems = isExpanded ? [] : items.slice(0, 6);
      const fullItems = items.concat([
        'Articolo 7', 'Articolo 8', 'Articolo 9', 'Articolo 10',
        'Articolo 11', 'Articolo 12', 'Articolo 13', 'Articolo 14'
      ]);
      
      return `
        <div class="vetrina-card-big ${isExpanded ? 'expanded' : ''}" id="showcase-${id}">
          <div class="vetrina-header" onclick="toggleShowcase(${id})">
            <div class="vetrina-top">
              <div class="vetrina-avatar"></div>
              <div class="vetrina-info">
                <h3>
                  ${shopName}
                  <span class="vetrina-expand-icon">▼</span>
                </h3>
                <p>${description}</p>
                <div class="vetrina-rating">
                  <span>⭐ ${rating.toFixed(1)}</span>
                  <span style="color: #6b7280;">•</span>
                  <span style="color: #9ca3af;">${reviews} recensioni</span>
                </div>
              </div>
            </div>
          </div>
          
          <div class="vetrina-stats">
            <div class="vetrina-stat">
              <div class="vetrina-stat-value">${articles}</div>
              <div class="vetrina-stat-label">Articoli</div>
            </div>
            <div class="vetrina-stat">
              <div class="vetrina-stat-value">${satisfaction}%</div>
              <div class="vetrina-stat-label">Soddisfazione</div>
            </div>
            <div class="vetrina-stat">
              <div class="vetrina-stat-value">${reviews}</div>
              <div class="vetrina-stat-label">Vendite</div>
            </div>
          </div>
          
          ${!isExpanded ? `
          <div class="vetrina-items-preview">
            ${previewItems.map(item => `<div class="vetrina-item">${item}</div>`).join('')}
          </div>
          ` : ''}
          
          <div class="vetrina-details">
            <div class="vetrina-full-catalog">
              <h4><i class="fas fa-box-open"></i> Catalogo Completo</h4>
              <div class="vetrina-catalog-grid">
                ${fullItems.map(item => `<div class="vetrina-item">${item}</div>`).join('')}
              </div>
            </div>
          </div>
        </div>
      `;
    }
    
    function toggleShowcase(id) {
      const idx = expandedShowcases.indexOf(id);
      if (idx > -1) {
        expandedShowcases.splice(idx, 1);
      } else {
        expandedShowcases.push(id);
      }
      loadVetrineView();
      setTimeout(() => {
        document.getElementById(`showcase-${id}`).scrollIntoView({ behavior: 'smooth', block: 'nearest' });
      }, 100);
    }

    // ========== COMMUNITY VIEW ==========
    let expandedEvents = [];
    
    function loadCommunityView() {
      document.getElementById('addBtnContainer').classList.remove('visible');
      
      const mainContent = document.getElementById('mainContent');
      mainContent.innerHTML = `
        <style>
          .community-grid {
            display: grid;
            gap: 20px;
            padding: 20px;
          }
          
          .post-card {
            background: linear-gradient(135deg, #1a1a1a 0%, #0f0f0f 100%);
            border-radius: 20px;
            border: 2px solid #2a2a2a;
            padding: 20px;
            transition: all 0.3s;
          }
          
          .post-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
          }
          
          .post-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            border: 2px solid #fbbf24;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: #000;
            font-weight: 900;
          }
          
          .post-user {
            flex: 1;
          }
          
          .post-user h4 {
            color: #fbbf24;
            font-size: 16px;
            margin-bottom: 4px;
            font-weight: 700;
          }
          
          .post-user span {
            color: #6b7280;
            font-size: 12px;
          }
          
          .post-content {
            color: #e5e7eb;
            margin-bottom: 16px;
            line-height: 1.6;
          }
          
          .post-actions {
            display: flex;
            gap: 20px;
            padding-top: 16px;
            border-top: 1px solid #2a2a2a;
          }
          
          .post-action-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 10px;
            border: none;
            background: transparent;
            color: #9ca3af;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
          }
          
          .post-action-btn.liked {
            color: #ef4444;
          }
          
          .post-action-btn:active {
            background: #2a2a2a;
            transform: scale(0.95);
          }
          
          .event-card-big {
            background: linear-gradient(135deg, #1f1f1f 0%, #1a1a1a 100%);
            border-radius: 24px;
            border: 3px solid #fbbf24;
            overflow: hidden;
            transition: all 0.4s;
          }
          
          .event-header {
            cursor: pointer;
            position: relative;
          }
          
          .event-card-big:not(.expanded) .event-header:hover {
            transform: translateY(-4px);
          }
          
          .event-video {
            width: 100%;
            height: 200px;
            background: linear-gradient(135deg, #2a2a2a 0%, #1a1a1a 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            color: #fbbf24;
            position: relative;
            overflow: hidden;
          }
          
          .event-video::before {
            content: '▶';
            position: absolute;
            font-size: 80px;
            opacity: 0.3;
            animation: pulse 2s infinite;
          }
          
          @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.3; }
            50% { transform: scale(1.1); opacity: 0.6; }
          }
          
          .event-info {
            padding: 20px;
          }
          
          .event-info h3 {
            color: #fbbf24;
            font-size: 20px;
            margin-bottom: 8px;
            font-weight: 800;
            display: flex;
            justify-content: space-between;
            align-items: center;
          }
          
          .event-expand-icon {
            font-size: 16px;
            transition: transform 0.3s;
          }
          
          .event-card-big.expanded .event-expand-icon {
            transform: rotate(180deg);
          }
          
          .event-info p {
            color: #9ca3af;
            line-height: 1.6;
          }
          
          .event-details {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease;
          }
          
          .event-card-big.expanded .event-details {
            max-height: 3000px;
          }
          
          .event-meta {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            padding: 20px;
            background: #0a0a0a;
            border-radius: 16px;
            margin: 20px 0;
          }
          
          .event-meta-item {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #e5e7eb;
            font-size: 14px;
            font-weight: 600;
          }
          
          .event-meta-item i {
            color: #fbbf24;
            width: 20px;
          }
          
          .vendor-section {
            margin-top: 20px;
          }
          
          .vendor-section h4 {
            color: #fbbf24;
            font-size: 18px;
            margin-bottom: 16px;
            font-weight: 800;
          }
          
          .vendor-grid {
            display: grid;
            gap: 16px;
          }
          
          .vendor-booth {
            background: #0a0a0a;
            border-radius: 16px;
            padding: 16px;
            border: 2px solid #2a2a2a;
            transition: all 0.3s;
          }
          
          .vendor-booth:active {
            border-color: #10b981;
            transform: translateY(-2px);
          }
          
          .vendor-booth-header {
            display: flex;
            gap: 12px;
            margin-bottom: 12px;
          }
          
          .vendor-photo {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            border: 3px solid #10b981;
            flex-shrink: 0;
          }
          
          .vendor-info h5 {
            color: #10b981;
            font-size: 16px;
            margin-bottom: 4px;
            font-weight: 700;
          }
          
          .vendor-info p {
            color: #6b7280;
            font-size: 13px;
          }
          
          .vendor-articles {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-top: 12px;
          }
          
          .vendor-article-mini {
            aspect-ratio: 2/3;
            background: #1a1a1a;
            border-radius: 8px;
            border: 2px solid #fbbf24;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            color: #9ca3af;
            text-align: center;
            padding: 4px;
          }
        </style>
        
        <div class="community-grid">
          ${createEventCard(1, 'Raduno Pokemon - Milano 2025', 'Milano Fiera', '15 Gennaio 2025', '500+ partecipanti', 'Il più grande evento Pokemon d\'Italia! Scambi, tornei, incontri con giocatori professionisti e tanto altro.')}
          
          ${createEventCard(2, 'Pokemon TCG Championship', 'Roma Convention Center', '22 Febbraio 2025', '300+ giocatori', 'Torneo nazionale ufficiale con premi incredibili e carte esclusive per tutti i partecipanti!')}
          
          ${createPostCard('MC', 'MarioCollector', '2 ore fa', 'Ho appena completato la mia collezione di Scarlatto e Violetto! Che emozione! 🎉', 42, 8, false)}
          
          ${createEventCard(3, 'Fiera del Collezionismo', 'Bologna Expo', '10 Marzo 2025', '200+ stand', 'La più grande fiera di collezionismo del centro Italia. Migliaia di carte, action figures e memorabilia!')}
          
          ${createPostCard('LT', 'LucaTrainer', '5 ore fa', 'Qualcuno scambia Charizard ex? Ho doppioni di Mewtwo! 🔥', 15, 12, false)}
          
          ${createPostCard('GP', 'GiuliaPokemon', '1 giorno fa', 'Appena aperto un ETB di Surging Sparks... PIKACHU EX FULL ART! 😱⚡', 89, 23, false)}
          
          ${createPostCard('AS', 'AndreaShiny', '2 giorni fa', 'Chi viene al raduno di Milano? Organizziamo un meet! 🤝', 34, 18, false)}
          
          ${createPostCard('FC', 'FrancescaCards', '3 giorni fa', 'La mia collezione ha superato le 1000 carte! Grazie a questa community per i consigli! ❤️', 67, 15, false)}
        </div>
      `;
    }
    
    function createEventCard(id, title, location, date, attendance, description) {
      const isExpanded = expandedEvents.includes(id);
      return `
        <div class="event-card-big ${isExpanded ? 'expanded' : ''}" id="event-${id}">
          <div class="event-header" onclick="toggleEvent(${id})">
            <div class="event-video">
              <i class="fas fa-calendar-days"></i>
            </div>
            <div class="event-info">
              <h3>
                ${title}
                <span class="event-expand-icon">▼</span>
              </h3>
              <p>${description}</p>
            </div>
          </div>
          
          <div class="event-details">
            <div style="padding: 0 20px 20px;">
              <div class="event-meta">
                <div class="event-meta-item">
                  <i class="fas fa-map-marker-alt"></i>
                  <span>${location}</span>
                </div>
                <div class="event-meta-item">
                  <i class="fas fa-calendar"></i>
                  <span>${date}</span>
                </div>
                <div class="event-meta-item">
                  <i class="fas fa-users"></i>
                  <span>${attendance}</span>
                </div>
                <div class="event-meta-item">
                  <i class="fas fa-ticket"></i>
                  <span>Ingresso gratuito</span>
                </div>
              </div>
              
              <div class="vendor-section">
                <h4><i class="fas fa-store"></i> Venditori Presenti</h4>
                <div class="vendor-grid">
                  ${createVendorBooth('CardsMaster Shop', 'Carte Rare & Vintage', ['Charizard ex', 'Pikachu VMAX', 'Mewtwo GX'])}
                  ${createVendorBooth('Pokemon Paradise', 'Nuove Espansioni', ['Booster TEF', 'ETB SVI', 'Tin Box'])}
                  ${createVendorBooth('Collector\'s Dream', 'Grading & Slabs', ['PSA 10 Cards', 'CGC Slabs', 'BGS 9.5'])}
                  ${createVendorBooth('Tokyo Cards Italia', 'Import Giapponese', ['Carte JAP', 'Promo Box', 'Sleeves'])}
                </div>
              </div>
            </div>
          </div>
        </div>
      `;
    }
    
    function createVendorBooth(name, category, articles) {
      return `
        <div class="vendor-booth">
          <div class="vendor-booth-header">
            <div class="vendor-photo"></div>
            <div class="vendor-info">
              <h5>${name}</h5>
              <p>${category}</p>
            </div>
          </div>
          <div class="vendor-articles">
            ${articles.map(art => `<div class="vendor-article-mini">${art}</div>`).join('')}
          </div>
        </div>
      `;
    }
    
    function createPostCard(avatar, username, time, content, likes, comments, isLiked) {
      return `
        <div class="post-card">
          <div class="post-header">
            <div class="post-avatar">${avatar}</div>
            <div class="post-user">
              <h4>${username}</h4>
              <span>${time}</span>
            </div>
          </div>
          <div class="post-content">${content}</div>
          <div class="post-actions">
            <button class="post-action-btn ${isLiked ? 'liked' : ''}" onclick="toggleLike(this)">
              <i class="fas fa-heart"></i>
              <span>${likes}</span>
            </button>
            <button class="post-action-btn" onclick="alert('💬 Commenti: Funzione in arrivo!')">
              <i class="fas fa-comment"></i>
              <span>${comments}</span>
            </button>
          </div>
        </div>
      `;
    }
    
    function toggleEvent(id) {
      const idx = expandedEvents.indexOf(id);
      if (idx > -1) {
        expandedEvents.splice(idx, 1);
      } else {
        expandedEvents.push(id);
      }
      loadCommunityView();
      setTimeout(() => {
        document.getElementById(`event-${id}`).scrollIntoView({ behavior: 'smooth', block: 'nearest' });
      }, 100);
    }
    
    function toggleLike(btn) {
      btn.classList.toggle('liked');
      const span = btn.querySelector('span');
      const currentLikes = parseInt(span.textContent);
      span.textContent = btn.classList.contains('liked') ? currentLikes + 1 : currentLikes - 1;
    }

    // ========== ARCHIVIO VIEW ==========
    function loadArchivioView() {
      const mainContent = document.getElementById('mainContent');
      
      // MOSTRA PULSANTE AGGIUNGI
      document.getElementById('addBtnContainer').classList.add('visible');
      
      mainContent.innerHTML = `
        <div class="dashboard" id="dashboard"></div>

        <div class="filter-box">
          <div class="filter-header" id="filterHeader">
            <div class="filter-title">
              <i class="fas fa-sliders-h"></i>
              FILTRI
            </div>
            <button class="filter-toggle" onclick="toggleFilters()" id="filterToggle">
              <i class="fas fa-chevron-down"></i>
            </button>
          </div>

          <div class="filter-content" id="filterContent">
            <div class="filter-grid">
              <div class="filter-group">
                <label><i class="fas fa-search"></i> Cerca Nome</label>
                <input type="text" id="fNome" placeholder="Es. Charizard, Pikachu...">
              </div>

              <div class="filter-group">
                <label><i class="fas fa-tag"></i> Categoria</label>
                <select id="fCategoria">
                  <option value="">Tutte le categorie</option>
                  <option value="Carta Singola">Carta Singola</option>
                  <option value="ETB">ETB</option>
                  <option value="Booster">Booster Pack</option>
                  <option value="Collection Box">Collection Box</option>
                  <option value="Altro">Altro</option>
                </select>
              </div>
            </div>

            <div class="range-group">
              <div class="range-header">
                <div class="range-label">
                  <i class="fas fa-euro-sign"></i>
                  Valore Attuale
                </div>
                <div class="range-value" id="rangeValoreDisplay">0€ - 1000€</div>
              </div>
              <div class="range-slider-container">
                <div class="range-track">
                  <div class="range-progress" id="rangeProgress"></div>
                </div>
                <input type="range" class="range-input" id="fValoreMin" min="0" max="1000" value="0" oninput="updateRangeSlider()">
                <input type="range" class="range-input" id="fValoreMax" min="0" max="1000" value="1000" oninput="updateRangeSlider()">
              </div>
            </div>

            <div class="range-group">
              <div class="range-header">
                <div class="range-label">
                  <i class="fas fa-star"></i>
                  Valutazione Minima
                </div>
                <div class="range-value" id="rangeStatoDisplay">Tutte</div>
              </div>
              <div class="filter-group">
                <select id="fStato" onchange="updateStatoDisplay()">
                  <option value="">Tutte le valutazioni</option>
                  <option value="10">10⭐ (Mint)</option>
                  <option value="9">9⭐+ (Near Mint+)</option>
                  <option value="8">8⭐+ (Near Mint)</option>
                  <option value="7">7⭐+ (Eccellente)</option>
                  <option value="6">6⭐+ (Buona)</option>
                  <option value="5">5⭐+ (Cattiva)</option>
                </select>
              </div>
            </div>

            <div class="toggle-group">
              <div class="toggle-option">
                <input type="checkbox" id="fPresenti" checked>
                <label for="fPresenti" class="toggle-label">
                  <i class="fas fa-check-circle"></i>
                  PRESENTI
                </label>
              </div>

              <div class="toggle-option">
                <input type="checkbox" id="fAssenti" checked>
                <label for="fAssenti" class="toggle-label">
                  <i class="fas fa-times-circle"></i>
                  ASSENTI
                </label>
              </div>

              <div class="toggle-option">
                <input type="checkbox" id="fProfit" checked>
                <label for="fProfit" class="toggle-label">
                  <i class="fas fa-arrow-up"></i>
                  PROFITTO
                </label>
              </div>

              <div class="toggle-option">
                <input type="checkbox" id="fLoss" checked>
                <label for="fLoss" class="toggle-label">
                  <i class="fas fa-arrow-down"></i>
                  PERDITA
                </label>
              </div>
            </div>

            <div class="filter-actions">
              <button class="btn-filter btn-apply" onclick="applicaFiltri()">
                <i class="fas fa-filter"></i>
                APPLICA
              </button>
              <button class="btn-filter btn-reset" onclick="resetFiltri()">
                <i class="fas fa-redo"></i>
                RESET
              </button>
            </div>
          </div>
        </div>

        <div class="pagination-container">
          <div class="pagination-info">
            Articolo <span id="pageStart">1</span>-<span id="pageEnd">10</span> di <span id="totalItems">0</span>
          </div>
          <div class="pagination-controls">
            <button class="pagination-btn" id="prevBtn" onclick="previousPage()">
              <i class="fas fa-chevron-left"></i>
            </button>
            <button class="pagination-btn" id="nextBtn" onclick="nextPage()">
              <i class="fas fa-chevron-right"></i>
            </button>
          </div>
        </div>

        <div class="articles-grid" id="articlesGrid"></div>
      `;

      updateRangeSlider();
      caricaArticoli();
    }

    // ========== FILTRI ==========
    function toggleFilters() {
      const content = document.getElementById('filterContent');
      const toggle = document.getElementById('filterToggle');
      const isExpanded = content.classList.contains('active');
      
      if (isExpanded) {
        content.classList.remove('active');
        toggle.classList.remove('expanded');
        toggle.querySelector('i').className = 'fas fa-chevron-down';
      } else {
        content.classList.add('active');
        toggle.classList.add('expanded');
        toggle.querySelector('i').className = 'fas fa-chevron-up';
      }
    }

    function updateRangeSlider() {
      const minInput = document.getElementById('fValoreMin');
      const maxInput = document.getElementById('fValoreMax');
      const display = document.getElementById('rangeValoreDisplay');
      const progress = document.getElementById('rangeProgress');
      
      if (!minInput || !maxInput) return;
      
      let min = parseInt(minInput.value);
      let max = parseInt(maxInput.value);
      
      if (min > max - 10) {
        min = max - 10;
        minInput.value = min;
      }
      if (max < min + 10) {
        max = min + 10;
        maxInput.value = max;
      }
      
      display.textContent = `${min}€ - ${max}€`;
      
      const minPercent = (min / 1000) * 100;
      const maxPercent = (max / 1000) * 100;
      
      progress.style.left = minPercent + '%';
      progress.style.width = (maxPercent - minPercent) + '%';
    }

    function updateStatoDisplay() {
      const stato = document.getElementById('fStato').value;
      const display = document.getElementById('rangeStatoDisplay');
      if (stato) {
        display.textContent = stato + '⭐+';
      } else {
        display.textContent = 'Tutte';
      }
    }

    function applicaFiltri() {
      currentPage = 1;
      filteredArticles = filterArticles();
      renderArticles();
      updatePagination();
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function resetFiltri() {
      document.getElementById('fNome').value = '';
      document.getElementById('fCategoria').value = '';
      document.getElementById('fValoreMin').value = '0';
      document.getElementById('fValoreMax').value = '1000';
      document.getElementById('fStato').value = '';
      document.getElementById('fPresenti').checked = true;
      document.getElementById('fAssenti').checked = true;
      document.getElementById('fProfit').checked = true;
      document.getElementById('fLoss').checked = true;
      
      updateRangeSlider();
      updateStatoDisplay();
      applicaFiltri();
    }

    function filterArticles() {
      const nome = document.getElementById('fNome').value.toLowerCase();
      const categoria = document.getElementById('fCategoria').value;
      const valoreMin = parseFloat(document.getElementById('fValoreMin').value) || 0;
      const valoreMax = parseFloat(document.getElementById('fValoreMax').value) || 999999;
      const statoMin = parseInt(document.getElementById('fStato').value) || 0;
      const presenti = document.getElementById('fPresenti').checked;
      const assenti = document.getElementById('fAssenti').checked;
      const profit = document.getElementById('fProfit').checked;
      const loss = document.getElementById('fLoss').checked;
      
      return allArticles.filter(article => {
        if (nome && !article.Nome.toLowerCase().includes(nome)) return false;
        if (categoria && article.Categoria !== categoria) return false;
        
        const valore = Number(article.ValoreAttuale) || 0;
        if (valore < valoreMin || valore > valoreMax) return false;
        
        const stato = Number(article.ValutazioneStato) || 0;
        if (statoMin > 0 && stato < statoMin) return false;
        
        if (!presenti && article.Presente) return false;
        if (!assenti && !article.Presente) return false;
        
        const delta = valore - (Number(article.PrezzoPagato) || 0);
        if (!profit && !loss) return true;
        if (profit && !loss && delta <= 0) return false;
        if (!profit && loss && delta >= 0) return false;
        
        return true;
      });
    }

    // ========== PAGINAZIONE ==========
    function previousPage() {
      if (currentPage > 1) {
        currentPage--;
        renderArticles();
        updatePagination();
        window.scrollTo({ top: 0, behavior: 'smooth' });
      }
    }

    function nextPage() {
      const totalPages = Math.ceil(filteredArticles.length / itemsPerPage);
      if (currentPage < totalPages) {
        currentPage++;
        renderArticles();
        updatePagination();
        window.scrollTo({ top: 0, behavior: 'smooth' });
      }
    }

    function updatePagination() {
      const totalItems = filteredArticles.length;
      const totalPages = Math.ceil(totalItems / itemsPerPage);
      const start = (currentPage - 1) * itemsPerPage + 1;
      const end = Math.min(currentPage * itemsPerPage, totalItems);
      
      document.getElementById('pageStart').textContent = totalItems > 0 ? start : 0;
      document.getElementById('pageEnd').textContent = end;
      document.getElementById('totalItems').textContent = totalItems;
      
      document.getElementById('prevBtn').disabled = currentPage === 1;
      document.getElementById('nextBtn').disabled = currentPage >= totalPages;
    }

    // ========== CARICAMENTO ARTICOLI ==========
    async function caricaArticoli() {
      try {
        const { data, error } = await client
          .from("Articoli")
          .select("*")
          .order('created_at', { ascending: false });
        
        if (error) throw error;
        
        allArticles = data || [];
        filteredArticles = [...allArticles];
        
        console.log('📦 Articoli caricati:', allArticles.length);
        
        renderDashboard();
        renderArticles();
        updatePagination();
      } catch (error) {
        console.error('❌ Errore caricamento:', error);
      }
    }

    function renderDashboard() {
      const dashboard = document.getElementById('dashboard');
      if (!dashboard) return;
      
      const totale = allArticles.length;
      const valoreAttuale = allArticles.reduce((sum, r) => sum + (Number(r.ValoreAttuale) || 0), 0);
      const prezzoPagato = allArticles.reduce((sum, r) => sum + (Number(r.PrezzoPagato) || 0), 0);
      const delta = valoreAttuale - prezzoPagato;
      const deltaPercent = prezzoPagato > 0 ? ((delta / prezzoPagato) * 100) : 0;
      
      dashboard.innerHTML = `
        <div class="stat-card yellow" onclick="apriGrafico('totale', 'yellow')">
          <div class="stat-icon"><i class="fas fa-layer-group"></i></div>
          <div class="stat-label">Totale Articoli</div>
          <div class="stat-value">${totale}</div>
          <div class="stat-subtext">nella collezione</div>
        </div>
        
        <div class="stat-card green" onclick="apriGrafico('valore', 'green')">
          <div class="stat-icon"><i class="fas fa-gem"></i></div>
          <div class="stat-label">Valore Totale</div>
          <div class="stat-value">${valoreAttuale.toFixed(2)} €</div>
          <div class="stat-subtext">valore di mercato</div>
        </div>
        
        <div class="stat-card orange" onclick="apriGrafico('spesa', 'orange')">
          <div class="stat-icon"><i class="fas fa-wallet"></i></div>
          <div class="stat-label">Spesa Totale</div>
          <div class="stat-value">${prezzoPagato.toFixed(2)} €</div>
          <div class="stat-subtext">investimento iniziale</div>
        </div>
        
        <div class="stat-card blue" onclick="apriGrafico('performance', 'blue')">
          <div class="stat-icon"><i class="fas fa-rocket"></i></div>
          <div class="stat-label">Performance</div>
          <div class="stat-value">${delta >= 0 ? '+' : ''}${delta.toFixed(2)} €</div>
          <div class="stat-subtext">${delta >= 0 ? '+' : ''}${deltaPercent.toFixed(1)}%</div>
        </div>
      `;
    }

    function renderArticles() {
      const grid = document.getElementById('articlesGrid');
      if (!grid) return;
      
      const start = (currentPage - 1) * itemsPerPage;
      const end = start + itemsPerPage;
      const pageArticles = filteredArticles.slice(start, end);
      
      if (pageArticles.length === 0) {
        grid.innerHTML = `
          <div class="wip-container">
            <div class="wip-icon"><i class="fas fa-inbox"></i></div>
            <div class="wip-text">Nessun Articolo</div>
            <div class="wip-subtext">Prova a modificare i filtri</div>
          </div>
        `;
        return;
      }
      
      grid.innerHTML = pageArticles.map(article => createArticleCard(article)).join('');
    }

    function createArticleCard(article) {
      const delta = (Number(article.ValoreAttuale) || 0) - (Number(article.PrezzoPagato) || 0);
      const statoStelle = article.ValutazioneStato ? '⭐'.repeat(Math.min(article.ValutazioneStato, 10)) : '—';
      const presenteBadge = article.Presente 
        ? '<span class="badge presente"><i class="fas fa-check"></i> PRESENTE</span>' 
        : '<span class="badge assente"><i class="fas fa-times"></i> ASSENTE</span>';
      
      return `
        <div class="article-card" id="card-${article.id}">
          <div class="article-header" onclick="toggleArticleCard(${article.id})">
            <div class="article-image-placeholder">
              IMMAGINE DI PROVA
            </div>
            <div class="article-header-info">
              <div class="article-title">
                <span class="article-title-text">${article.Nome || 'Senza nome'}</span>
                <span class="expand-icon">▼</span>
              </div>
              <div class="article-subtitle">
                <i class="fas fa-layer-group"></i> ${article.Categoria || 'Nessuna categoria'}
              </div>
            </div>
          </div>
          <div class="article-body">
            <div class="article-body-content">
              <div class="article-row">
                <span class="article-label"><i class="fas fa-gem"></i> VALORE</span>
                <span class="article-value" style="color: #10b981; font-weight: 700;">${Number(article.ValoreAttuale || 0).toFixed(2)} €</span>
              </div>
              <div class="article-row">
                <span class="article-label"><i class="fas fa-receipt"></i> PREZZO PAGATO</span>
                <span class="article-value">${Number(article.PrezzoPagato || 0).toFixed(2)} €</span>
              </div>
              <div class="article-row">
                <span class="article-label"><i class="fas fa-chart-line"></i> GUADAGNO/PERDITA</span>
                <span class="article-value" style="color: ${delta >= 0 ? '#10b981' : '#ef4444'}; font-weight: 800;">
                  ${delta >= 0 ? '+' : ''}${delta.toFixed(2)} €
                </span>
              </div>
              <div class="article-row">
                <span class="article-label"><i class="fas fa-star"></i> VALUTAZIONE</span>
                <span class="article-value">${statoStelle}</span>
              </div>
              <div class="article-row">
                <span class="article-label"><i class="fas fa-warehouse"></i> STATO</span>
                <span class="article-value">${presenteBadge}</span>
              </div>
              <div class="article-actions">
                <button class="btn-edit" onclick="apriModifica(${article.id})">
                  <i class="fas fa-edit"></i> MODIFICA
                </button>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    function toggleArticleCard(id) {
      const card = document.getElementById(`card-${id}`);
      if (card) {
        card.classList.toggle('expanded');
      }
    }

    function apriModifica(id) {
      const article = allArticles.find(a => a.id === id);
      if (!article) return;
      
      // Reset scroll e blocca body
      window.scrollTo({ top: 0, behavior: 'instant' });
      document.body.style.overflow = 'hidden';
      
      document.getElementById('editId').value = article.id;
      document.getElementById('editNome').value = article.Nome || '';
      document.getElementById('editCategoria').value = article.Categoria || '';
      document.getElementById('editDescrizione').value = article.Descrizione || '';
      document.getElementById('editValoreAttuale').value = article.ValoreAttuale || '';
      document.getElementById('editPrezzoPagato').value = article.PrezzoPagato || '';
      document.getElementById('editStato').value = article.ValutazioneStato || '';
      document.getElementById('editPresente').checked = article.Presente || false;
      calcolaDeltaEdit();
      
      const modal = document.getElementById('modalEdit');
      modal.scrollTop = 0;
      modal.classList.add('active');
    }

    // ========== MODALS ==========
    function openAddModal() {
      const modal = document.getElementById('modalAdd');
      const modalContent = modal.querySelector('.modal-add-content');
      
      // Reset scroll del modal e della pagina
      window.scrollTo({ top: 0, behavior: 'instant' });
      modal.scrollTop = 0;
      if (modalContent) modalContent.scrollTop = 0;
      
      // Blocca scroll della pagina
      document.body.style.overflow = 'hidden';
      
      // Forza reflow per assicurare posizionamento corretto
      modal.style.display = 'none';
      modal.offsetHeight; // trigger reflow
      
      modal.classList.remove('closing');
      modal.classList.add('active');
      modal.style.display = '';
    }

    function closeAddModal() {
      const modal = document.getElementById('modalAdd');
      modal.classList.add('closing');
      
      // Riattiva scroll della pagina
      document.body.style.overflow = '';
      
      setTimeout(() => {
        modal.classList.remove('active', 'closing');
      }, 400);
      
      if (stream) {
        stream.getTracks().forEach(track => track.stop());
        document.getElementById('cameraContainer').classList.remove('active');
      }
    }

    function closeEditModal() {
      const modal = document.getElementById('modalEdit');
      modal.classList.add('closing');
      
      // Riattiva scroll della pagina
      document.body.style.overflow = '';
      
      setTimeout(() => {
        modal.classList.remove('active', 'closing');
      }, 400);
    }

    function closeGraphModal() {
      const modal = document.getElementById('modalGraph');
      modal.classList.add('closing');
      
      // Riattiva scroll della pagina
      document.body.style.overflow = '';
      
      setTimeout(() => {
        modal.classList.remove('active', 'closing');
        if (currentChart) {
          currentChart.destroy();
          currentChart = null;
        }
      }, 400);
    }

    // ========== FORM FUNCTIONS ==========
    function calcolaDeltaAdd() {
      const valore = parseFloat(document.getElementById('valoreAttualeAdd').value) || 0;
      const prezzo = parseFloat(document.getElementById('prezzoPagatoAdd').value) || 0;
      document.getElementById('deltaAdd').value = (valore - prezzo).toFixed(2);
    }

    function calcolaDeltaEdit() {
      const valore = parseFloat(document.getElementById('editValoreAttuale').value) || 0;
      const prezzo = parseFloat(document.getElementById('editPrezzoPagato').value) || 0;
      document.getElementById('editDelta').value = (valore - prezzo).toFixed(2);
    }

    async function aggiungiArticolo(e) {
      e.preventDefault();
      const form = e.target;
      const formData = new FormData(form);
      const valore = parseFloat(formData.get('ValoreAttuale'));
      const prezzo = parseFloat(formData.get('PrezzoPagato'));

      const articolo = {
        Nome: formData.get('Nome'),
        Descrizione: formData.get('Descrizione') || null,
        Categoria: formData.get('Categoria') || null,
        ValoreAttuale: valore,
        PrezzoPagato: prezzo,
        Delta: valore - prezzo,
        ValutazioneStato: formData.get('ValutazioneStato') ? parseInt(formData.get('ValutazioneStato')) : null,
        Presente: formData.get('Presente') === 'on'
      };

      const { error } = await client.from('Articoli').insert([articolo]);
      const msg = document.getElementById('addMsg');

      if (error) {
        msg.className = 'msg error';
        msg.textContent = '❌ ERRORE: ' + error.message;
        msg.style.display = 'block';
      } else {
        msg.className = 'msg success';
        msg.textContent = '✅ AGGIUNTO!';
        msg.style.display = 'block';
        form.reset();
        document.getElementById('deltaAdd').value = '';
        setTimeout(() => {
          closeAddModal();
          caricaArticoli();
        }, 1500);
      }
    }

    async function salvaModifica(e) {
      e.preventDefault();
      const formData = new FormData(e.target);
      const valore = parseFloat(formData.get('ValoreAttuale'));
      const prezzo = parseFloat(formData.get('PrezzoPagato'));
      const id = document.getElementById('editId').value;

      const articolo = {
        Nome: formData.get('Nome'),
        Descrizione: formData.get('Descrizione') || null,
        Categoria: formData.get('Categoria') || null,
        ValoreAttuale: valore,
        PrezzoPagato: prezzo,
        Delta: valore - prezzo,
        ValutazioneStato: formData.get('ValutazioneStato') ? parseInt(formData.get('ValutazioneStato')) : null,
        Presente: formData.get('Presente') === 'on'
      };

      const { error } = await client.from('Articoli').update(articolo).eq('id', id);
      const msg = document.getElementById('editMsg');

      if (error) {
        msg.className = 'msg error';
        msg.textContent = '❌ ERRORE: ' + error.message;
        msg.style.display = 'block';
      } else {
        msg.className = 'msg success';
        msg.textContent = '✅ SALVATO!';
        msg.style.display = 'block';
        setTimeout(() => {
          closeEditModal();
          caricaArticoli();
        }, 1500);
      }
    }

    async function eliminaArticolo() {
      const id = document.getElementById('editId').value;
      const nome = document.getElementById('editNome').value;
      if (!confirm(`⚠️ ELIMINARE "${nome}"?`)) return;

      const { error } = await client.from('Articoli').delete().eq('id', id);
      const msg = document.getElementById('editMsg');

      if (error) {
        msg.className = 'msg error';
        msg.textContent = '❌ ERRORE: ' + error.message;
        msg.style.display = 'block';
      } else {
        msg.className = 'msg success';
        msg.textContent = '✅ ELIMINATO!';
        msg.style.display = 'block';
        setTimeout(() => {
          closeEditModal();
          caricaArticoli();
        }, 1500);
      }
    }

<!-- FINE PARTE 3 - Continua con PARTE 4 -->

